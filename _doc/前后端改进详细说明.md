# 前后端改进详细说明

## 1. 与后端交互的配置项，只在后端配置
### 1.1 存在问题
* 修改前后端都需要的配置项，需要注意前后端 **两个地方** 的配置项。
* 修改前后端都需要的配置项，在多个点的配置，需要 **对应** 起来。
* 有些常用的配置项直接写在前端代码或者后端代码里面，需要开发者侵入代码修改。

### 1.2 升级建议
* 前后端的配置统一写在后端，编辑器实例化时，异步读取后端配置信息，覆盖到前端的配置里。
* 把散落在代码里的常用配置项，提出来放到后端配置里。

### 1.3 升级前后对比
    对前后端通信的配置，开发者只需要关注后端一个文件。

## 2. 统一接口
### 2.1 存在问题
* 请求发送给不同的文件，各自要维护自己的

### 2.2 改进建议

## 3. 统一返回值
### 3.1 存在问题
多个功能的,前后端交互的功能,返回值不一致,不便于管理代码和二次开发
现有各通信的返回值:
* 上传图片/上传附件/上传视频/word文档图片转存/拖放/粘贴板上传/截图工具上传
```
{'url':'upload/demo.jpg','title':'demo.jpg','original':'demo.jpg','state':'SUCCESS'}
```
* 涂鸦上传(添加背景)
```
<script>parent.ue_callback('upload/demo.jpg','SUCCESS')</script>
```
* 涂鸦上传(上传涂鸦完成后的base64图片)
```
{'url':'upload/demo.jpg',state:'SUCCESS'}
```
* 在线图片管理
```
upload/1.jpgue_separate_ueupload/2.jpg
```
* 远程图片
```
{'url':'upload/1.jpgue_separate_ueupload/2.jpg','tip':'远程图片抓取成功！','srcUrl':'http://img.baidu.com/1.jpgue_separate_uehttp://img.baidu.com/2.jpg'}
```

### 3.2 升级建议
参照上传图片,把其他返回格式修改成返回json格式数据,其中包含state属性,成功返回'SUCCESS',错误返回错误信息

#### 3.2.1 上传图片等相同请求保持原有格式
请求参数:
```javascript
GET {"action": "uploadimage"}
POST "upfile": File Data
```
返回数据:
```javascript
{
	"state": "SUCCESS",
    "url": "upload/demo.jpg",
	"title": "demo.jpg",
	"original": "demo.jpg"
}
```
#### 3.2.2 去除涂鸦添加背景的请求,用前端FileReader读取本地图片代替
#### 3.2.3 涂鸦完成后,上传base64图片,修改成上传图片一样的返回格式
请求参数:
```
GET {"action": "uploadscrawl"}
POST "content": File Data
```
返回值和上传图片一致
#### 3.2.4 在线图片管理修改成以下格式:
请求参数:
```
GET {"action": "listimage", "start": 0, "size": 20}
```
返回数据:
```javascript
// 需要支持callback参数,返回jsonp格式
{
    "state": "SUCCESS",
    "list": [
        {"url": "upload/1.jpg"},
        {"url": "upload/2.jpg"},
    ],
    "start": 20,
    "total": 100
}
```
#### 3.2.5 获取远程图片修改成以下格式:
请求参数:
```
GET {
    "action": "crawler",
     "source": [
        "http://a.com/1.jpg",
        "http://b.com/2.jpg"
    ]
}
```
返回数据:
```javascript
// 需要支持callback参数,返回jsonp格式
{
    "state": "SUCCESS",
    "url": [
        "upload/1.jpg",
        "upload/2.jpg"
    ],
    "src": [
        "http://a.com/1.jpg",
        "http://b.com/2.jpg"
    ]
}
```

## 4. 格式化上传文件名

之前已完成了文件名自定义格式化的功能，由于安全性问题和乱码的问题，暂时没上线功能。现在配置项放到后台比较安全，并且上传工具试用webuploader，编码可控，可以正式上线该功能。
[文件名格式化的文档](http://fex.baidu.com/ueditor/#use-format_upload_filename)

## 5. 兼容旧版本

 * 原有ueditor.config.js可以保留使用
