/* automatically generated by JSCoverage - do not edit */
try {
  if (typeof top === 'object' && top !== null && typeof top.opener === 'object' && top.opener !== null) {
    // this is a browser window that was opened from another window

    if (! top.opener._$jscoverage) {
      top.opener._$jscoverage = {};
    }
  }
}
catch (e) {}

try {
  if (typeof top === 'object' && top !== null) {
    // this is a browser window

    try {
      if (typeof top.opener === 'object' && top.opener !== null && top.opener._$jscoverage) {
        top._$jscoverage = top.opener._$jscoverage;
      }
    }
    catch (e) {}

    if (! top._$jscoverage) {
      top._$jscoverage = {};
    }
  }
}
catch (e) {}

try {
  if (typeof top === 'object' && top !== null && top._$jscoverage) {
    _$jscoverage = top._$jscoverage;
  }
}
catch (e) {}
if (typeof _$jscoverage !== 'object') {
  _$jscoverage = {};
}
if (! _$jscoverage['plugins/undo.js']) {
  _$jscoverage['plugins/undo.js'] = [];
  _$jscoverage['plugins/undo.js'][10] = 0;
  _$jscoverage['plugins/undo.js'][11] = 0;
  _$jscoverage['plugins/undo.js'][17] = 0;
  _$jscoverage['plugins/undo.js'][18] = 0;
  _$jscoverage['plugins/undo.js'][19] = 0;
  _$jscoverage['plugins/undo.js'][20] = 0;
  _$jscoverage['plugins/undo.js'][21] = 0;
  _$jscoverage['plugins/undo.js'][22] = 0;
  _$jscoverage['plugins/undo.js'][24] = 0;
  _$jscoverage['plugins/undo.js'][27] = 0;
  _$jscoverage['plugins/undo.js'][28] = 0;
  _$jscoverage['plugins/undo.js'][29] = 0;
  _$jscoverage['plugins/undo.js'][31] = 0;
  _$jscoverage['plugins/undo.js'][32] = 0;
  _$jscoverage['plugins/undo.js'][34] = 0;
  _$jscoverage['plugins/undo.js'][37] = 0;
  _$jscoverage['plugins/undo.js'][38] = 0;
  _$jscoverage['plugins/undo.js'][39] = 0;
  _$jscoverage['plugins/undo.js'][41] = 0;
  _$jscoverage['plugins/undo.js'][44] = 0;
  _$jscoverage['plugins/undo.js'][48] = 0;
  _$jscoverage['plugins/undo.js'][49] = 0;
  _$jscoverage['plugins/undo.js'][50] = 0;
  _$jscoverage['plugins/undo.js'][51] = 0;
  _$jscoverage['plugins/undo.js'][52] = 0;
  _$jscoverage['plugins/undo.js'][53] = 0;
  _$jscoverage['plugins/undo.js'][54] = 0;
  _$jscoverage['plugins/undo.js'][55] = 0;
  _$jscoverage['plugins/undo.js'][60] = 0;
  _$jscoverage['plugins/undo.js'][61] = 0;
  _$jscoverage['plugins/undo.js'][63] = 0;
  _$jscoverage['plugins/undo.js'][64] = 0;
  _$jscoverage['plugins/undo.js'][65] = 0;
  _$jscoverage['plugins/undo.js'][67] = 0;
  _$jscoverage['plugins/undo.js'][68] = 0;
  _$jscoverage['plugins/undo.js'][69] = 0;
  _$jscoverage['plugins/undo.js'][70] = 0;
  _$jscoverage['plugins/undo.js'][73] = 0;
  _$jscoverage['plugins/undo.js'][76] = 0;
  _$jscoverage['plugins/undo.js'][77] = 0;
  _$jscoverage['plugins/undo.js'][78] = 0;
  _$jscoverage['plugins/undo.js'][79] = 0;
  _$jscoverage['plugins/undo.js'][80] = 0;
  _$jscoverage['plugins/undo.js'][81] = 0;
  _$jscoverage['plugins/undo.js'][84] = 0;
  _$jscoverage['plugins/undo.js'][88] = 0;
  _$jscoverage['plugins/undo.js'][89] = 0;
  _$jscoverage['plugins/undo.js'][92] = 0;
  _$jscoverage['plugins/undo.js'][94] = 0;
  _$jscoverage['plugins/undo.js'][95] = 0;
  _$jscoverage['plugins/undo.js'][96] = 0;
  _$jscoverage['plugins/undo.js'][97] = 0;
  _$jscoverage['plugins/undo.js'][101] = 0;
  _$jscoverage['plugins/undo.js'][102] = 0;
  _$jscoverage['plugins/undo.js'][103] = 0;
  _$jscoverage['plugins/undo.js'][105] = 0;
  _$jscoverage['plugins/undo.js'][108] = 0;
  _$jscoverage['plugins/undo.js'][109] = 0;
  _$jscoverage['plugins/undo.js'][113] = 0;
  _$jscoverage['plugins/undo.js'][114] = 0;
  _$jscoverage['plugins/undo.js'][115] = 0;
  _$jscoverage['plugins/undo.js'][116] = 0;
  _$jscoverage['plugins/undo.js'][117] = 0;
  _$jscoverage['plugins/undo.js'][118] = 0;
  _$jscoverage['plugins/undo.js'][120] = 0;
  _$jscoverage['plugins/undo.js'][125] = 0;
  _$jscoverage['plugins/undo.js'][126] = 0;
  _$jscoverage['plugins/undo.js'][129] = 0;
  _$jscoverage['plugins/undo.js'][132] = 0;
  _$jscoverage['plugins/undo.js'][134] = 0;
  _$jscoverage['plugins/undo.js'][135] = 0;
  _$jscoverage['plugins/undo.js'][137] = 0;
  _$jscoverage['plugins/undo.js'][138] = 0;
  _$jscoverage['plugins/undo.js'][140] = 0;
  _$jscoverage['plugins/undo.js'][141] = 0;
  _$jscoverage['plugins/undo.js'][143] = 0;
  _$jscoverage['plugins/undo.js'][145] = 0;
  _$jscoverage['plugins/undo.js'][146] = 0;
  _$jscoverage['plugins/undo.js'][147] = 0;
  _$jscoverage['plugins/undo.js'][149] = 0;
  _$jscoverage['plugins/undo.js'][150] = 0;
  _$jscoverage['plugins/undo.js'][151] = 0;
  _$jscoverage['plugins/undo.js'][152] = 0;
  _$jscoverage['plugins/undo.js'][153] = 0;
  _$jscoverage['plugins/undo.js'][154] = 0;
  _$jscoverage['plugins/undo.js'][156] = 0;
  _$jscoverage['plugins/undo.js'][157] = 0;
  _$jscoverage['plugins/undo.js'][158] = 0;
  _$jscoverage['plugins/undo.js'][162] = 0;
  _$jscoverage['plugins/undo.js'][163] = 0;
  _$jscoverage['plugins/undo.js'][164] = 0;
  _$jscoverage['plugins/undo.js'][167] = 0;
  _$jscoverage['plugins/undo.js'][168] = 0;
  _$jscoverage['plugins/undo.js'][171] = 0;
  _$jscoverage['plugins/undo.js'][172] = 0;
  _$jscoverage['plugins/undo.js'][174] = 0;
  _$jscoverage['plugins/undo.js'][175] = 0;
  _$jscoverage['plugins/undo.js'][176] = 0;
  _$jscoverage['plugins/undo.js'][179] = 0;
  _$jscoverage['plugins/undo.js'][181] = 0;
  _$jscoverage['plugins/undo.js'][184] = 0;
  _$jscoverage['plugins/undo.js'][189] = 0;
  _$jscoverage['plugins/undo.js'][198] = 0;
  _$jscoverage['plugins/undo.js'][199] = 0;
  _$jscoverage['plugins/undo.js'][200] = 0;
  _$jscoverage['plugins/undo.js'][201] = 0;
  _$jscoverage['plugins/undo.js'][203] = 0;
  _$jscoverage['plugins/undo.js'][204] = 0;
  _$jscoverage['plugins/undo.js'][208] = 0;
  _$jscoverage['plugins/undo.js'][213] = 0;
  _$jscoverage['plugins/undo.js'][214] = 0;
  _$jscoverage['plugins/undo.js'][215] = 0;
  _$jscoverage['plugins/undo.js'][216] = 0;
  _$jscoverage['plugins/undo.js'][217] = 0;
  _$jscoverage['plugins/undo.js'][218] = 0;
  _$jscoverage['plugins/undo.js'][219] = 0;
  _$jscoverage['plugins/undo.js'][220] = 0;
  _$jscoverage['plugins/undo.js'][221] = 0;
  _$jscoverage['plugins/undo.js'][222] = 0;
  _$jscoverage['plugins/undo.js'][226] = 0;
  _$jscoverage['plugins/undo.js'][227] = 0;
  _$jscoverage['plugins/undo.js'][228] = 0;
  _$jscoverage['plugins/undo.js'][230] = 0;
  _$jscoverage['plugins/undo.js'][231] = 0;
  _$jscoverage['plugins/undo.js'][232] = 0;
  _$jscoverage['plugins/undo.js'][233] = 0;
  _$jscoverage['plugins/undo.js'][234] = 0;
  _$jscoverage['plugins/undo.js'][235] = 0;
  _$jscoverage['plugins/undo.js'][236] = 0;
  _$jscoverage['plugins/undo.js'][240] = 0;
  _$jscoverage['plugins/undo.js'][241] = 0;
  _$jscoverage['plugins/undo.js'][242] = 0;
  _$jscoverage['plugins/undo.js'][243] = 0;
  _$jscoverage['plugins/undo.js'][244] = 0;
  _$jscoverage['plugins/undo.js'][245] = 0;
  _$jscoverage['plugins/undo.js'][246] = 0;
  _$jscoverage['plugins/undo.js'][252] = 0;
  _$jscoverage['plugins/undo.js'][253] = 0;
}
_$jscoverage['plugins/undo.js'].source = ["<span class=\"c\">///import core</span>","<span class=\"c\">///commands &#25764;&#38144;&#21644;&#37325;&#20570;</span>","<span class=\"c\">///commandsName  Undo,Redo</span>","<span class=\"c\">///commandsTitle  &#25764;&#38144;,&#37325;&#20570;</span>","<span class=\"c\">/**</span>","<span class=\"c\"> * @description &#22238;&#36864;</span>","<span class=\"c\"> * @author zhanyi</span>","<span class=\"c\"> */</span>","","UE<span class=\"k\">.</span>plugins<span class=\"k\">[</span><span class=\"s\">'undo'</span><span class=\"k\">]</span> <span class=\"k\">=</span> <span class=\"k\">function</span> <span class=\"k\">()</span> <span class=\"k\">{</span>","    <span class=\"k\">var</span> me <span class=\"k\">=</span> <span class=\"k\">this</span><span class=\"k\">,</span>","        maxUndoCount <span class=\"k\">=</span> me<span class=\"k\">.</span>options<span class=\"k\">.</span>maxUndoCount <span class=\"k\">||</span> <span class=\"s\">20</span><span class=\"k\">,</span>","        maxInputCount <span class=\"k\">=</span> me<span class=\"k\">.</span>options<span class=\"k\">.</span>maxInputCount <span class=\"k\">||</span> <span class=\"s\">20</span><span class=\"k\">,</span>","        fillchar <span class=\"k\">=</span> <span class=\"k\">new</span> RegExp<span class=\"k\">(</span>domUtils<span class=\"k\">.</span>fillChar <span class=\"k\">+</span> <span class=\"s\">'|&lt;</span><span class=\"t\">\\/</span><span class=\"s\">hr&gt;'</span><span class=\"k\">,</span> <span class=\"s\">'gi'</span><span class=\"k\">);</span><span class=\"c\">// ie&#20250;&#20135;&#29983;&#22810;&#20313;&#30340;&lt;/hr&gt;</span>","","","    <span class=\"k\">function</span> compareAddr<span class=\"k\">(</span>indexA<span class=\"k\">,</span> indexB<span class=\"k\">)</span> <span class=\"k\">{</span>","        <span class=\"k\">if</span> <span class=\"k\">(</span>indexA<span class=\"k\">.</span>length <span class=\"k\">!=</span> indexB<span class=\"k\">.</span>length<span class=\"k\">)</span>","            <span class=\"k\">return</span> <span class=\"s\">0</span><span class=\"k\">;</span>","        <span class=\"k\">for</span> <span class=\"k\">(</span><span class=\"k\">var</span> i <span class=\"k\">=</span> <span class=\"s\">0</span><span class=\"k\">,</span> l <span class=\"k\">=</span> indexA<span class=\"k\">.</span>length<span class=\"k\">;</span> i <span class=\"k\">&lt;</span> l<span class=\"k\">;</span> i<span class=\"k\">++)</span> <span class=\"k\">{</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span>indexA<span class=\"k\">[</span>i<span class=\"k\">]</span> <span class=\"k\">!=</span> indexB<span class=\"k\">[</span>i<span class=\"k\">])</span>","                <span class=\"k\">return</span> <span class=\"s\">0</span>","        <span class=\"k\">}</span>","        <span class=\"k\">return</span> <span class=\"s\">1</span><span class=\"k\">;</span>","    <span class=\"k\">}</span>","","    <span class=\"k\">function</span> compareRangeAddress<span class=\"k\">(</span>rngAddrA<span class=\"k\">,</span> rngAddrB<span class=\"k\">)</span> <span class=\"k\">{</span>","        <span class=\"k\">if</span> <span class=\"k\">(</span>rngAddrA<span class=\"k\">.</span>collapsed <span class=\"k\">!=</span> rngAddrB<span class=\"k\">.</span>collapsed<span class=\"k\">)</span> <span class=\"k\">{</span>","            <span class=\"k\">return</span> <span class=\"s\">0</span><span class=\"k\">;</span>","        <span class=\"k\">}</span>","        <span class=\"k\">if</span> <span class=\"k\">(!</span>compareAddr<span class=\"k\">(</span>rngAddrA<span class=\"k\">.</span>startAddress<span class=\"k\">,</span> rngAddrB<span class=\"k\">.</span>startAddress<span class=\"k\">)</span> <span class=\"k\">||</span> <span class=\"k\">!</span>compareAddr<span class=\"k\">(</span>rngAddrA<span class=\"k\">.</span>endAddress<span class=\"k\">,</span> rngAddrB<span class=\"k\">.</span>endAddress<span class=\"k\">))</span> <span class=\"k\">{</span>","            <span class=\"k\">return</span> <span class=\"s\">0</span><span class=\"k\">;</span>","        <span class=\"k\">}</span>","        <span class=\"k\">return</span> <span class=\"s\">1</span><span class=\"k\">;</span>","    <span class=\"k\">}</span>","","    <span class=\"k\">function</span> adjustContent<span class=\"k\">(</span>cont<span class=\"k\">)</span> <span class=\"k\">{</span>","        <span class=\"k\">var</span> specialAttr <span class=\"k\">=</span> <span class=\"s\">/\\b(?:href|src|name)=\"[^\"]*?\"/gi</span><span class=\"k\">;</span>","        <span class=\"k\">return</span> cont<span class=\"k\">.</span>replace<span class=\"k\">(</span>specialAttr<span class=\"k\">,</span> <span class=\"s\">''</span><span class=\"k\">)</span>","            <span class=\"k\">.</span>replace<span class=\"k\">(</span><span class=\"s\">/([\\w\\-]*?)\\s*=\\s*((\"([^\"]*)\")|('([^']*)')|([^\\s&gt;]+))/gi</span><span class=\"k\">,</span> <span class=\"k\">function</span> <span class=\"k\">(</span>a<span class=\"k\">,</span> b<span class=\"k\">,</span> c<span class=\"k\">)</span> <span class=\"k\">{</span>","                <span class=\"k\">return</span> b<span class=\"k\">.</span>toLowerCase<span class=\"k\">()</span> <span class=\"k\">+</span> <span class=\"s\">'='</span> <span class=\"k\">+</span> c<span class=\"k\">.</span>replace<span class=\"k\">(</span><span class=\"s\">/['\"]/g</span><span class=\"k\">,</span> <span class=\"s\">''</span><span class=\"k\">).</span>toLowerCase<span class=\"k\">()</span>","            <span class=\"k\">}</span><span class=\"k\">)</span>","            <span class=\"k\">.</span>replace<span class=\"k\">(</span><span class=\"s\">/(&lt;[\\w\\-]+)|([\\w\\-]+&gt;)/gi</span><span class=\"k\">,</span> <span class=\"k\">function</span> <span class=\"k\">(</span>a<span class=\"k\">,</span> b<span class=\"k\">,</span> c<span class=\"k\">)</span> <span class=\"k\">{</span>","                <span class=\"k\">return</span> <span class=\"k\">(</span>b <span class=\"k\">||</span> c<span class=\"k\">).</span>toLowerCase<span class=\"k\">()</span>","            <span class=\"k\">}</span><span class=\"k\">);</span>","    <span class=\"k\">}</span>","","    <span class=\"k\">function</span> UndoManager<span class=\"k\">()</span> <span class=\"k\">{</span>","        <span class=\"k\">this</span><span class=\"k\">.</span>list <span class=\"k\">=</span> <span class=\"k\">[];</span>","        <span class=\"k\">this</span><span class=\"k\">.</span>index <span class=\"k\">=</span> <span class=\"s\">0</span><span class=\"k\">;</span>","        <span class=\"k\">this</span><span class=\"k\">.</span>hasUndo <span class=\"k\">=</span> <span class=\"k\">false</span><span class=\"k\">;</span>","        <span class=\"k\">this</span><span class=\"k\">.</span>hasRedo <span class=\"k\">=</span> <span class=\"k\">false</span><span class=\"k\">;</span>","        <span class=\"k\">this</span><span class=\"k\">.</span>undo <span class=\"k\">=</span> <span class=\"k\">function</span> <span class=\"k\">()</span> <span class=\"k\">{</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span><span class=\"k\">this</span><span class=\"k\">.</span>hasUndo<span class=\"k\">)</span> <span class=\"k\">{</span>","                <span class=\"k\">var</span> currentScene <span class=\"k\">=</span> <span class=\"k\">this</span><span class=\"k\">.</span>getScene<span class=\"k\">(),</span>","                    lastScene <span class=\"k\">=</span> <span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">[</span><span class=\"k\">this</span><span class=\"k\">.</span>index<span class=\"k\">],</span>","                    lastContent <span class=\"k\">=</span> adjustContent<span class=\"k\">(</span>lastScene<span class=\"k\">.</span>content<span class=\"k\">),</span>","                    currentContent <span class=\"k\">=</span> adjustContent<span class=\"k\">(</span>currentScene<span class=\"k\">.</span>content<span class=\"k\">);</span>","","                <span class=\"k\">if</span> <span class=\"k\">(</span>lastContent <span class=\"k\">!=</span> currentContent<span class=\"k\">)</span> <span class=\"k\">{</span>","                    <span class=\"k\">this</span><span class=\"k\">.</span>save<span class=\"k\">();</span>","                <span class=\"k\">}</span>","                <span class=\"k\">if</span> <span class=\"k\">(!</span><span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">[</span><span class=\"k\">this</span><span class=\"k\">.</span>index <span class=\"k\">-</span> <span class=\"s\">1</span><span class=\"k\">]</span> <span class=\"k\">&amp;&amp;</span> <span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">.</span>length <span class=\"k\">==</span> <span class=\"s\">1</span><span class=\"k\">)</span> <span class=\"k\">{</span>","                    <span class=\"k\">this</span><span class=\"k\">.</span>reset<span class=\"k\">();</span>","                    <span class=\"k\">return</span><span class=\"k\">;</span>","                <span class=\"k\">}</span>","                <span class=\"k\">while</span> <span class=\"k\">(</span><span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">[</span><span class=\"k\">this</span><span class=\"k\">.</span>index<span class=\"k\">].</span>content <span class=\"k\">==</span> <span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">[</span><span class=\"k\">this</span><span class=\"k\">.</span>index <span class=\"k\">-</span> <span class=\"s\">1</span><span class=\"k\">].</span>content<span class=\"k\">)</span> <span class=\"k\">{</span>","                    <span class=\"k\">this</span><span class=\"k\">.</span>index<span class=\"k\">--;</span>","                    <span class=\"k\">if</span> <span class=\"k\">(</span><span class=\"k\">this</span><span class=\"k\">.</span>index <span class=\"k\">==</span> <span class=\"s\">0</span><span class=\"k\">)</span> <span class=\"k\">{</span>","                        <span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"k\">.</span>restore<span class=\"k\">(</span><span class=\"s\">0</span><span class=\"k\">);</span>","                    <span class=\"k\">}</span>","                <span class=\"k\">}</span>","                <span class=\"k\">this</span><span class=\"k\">.</span>restore<span class=\"k\">(--</span><span class=\"k\">this</span><span class=\"k\">.</span>index<span class=\"k\">);</span>","            <span class=\"k\">}</span>","        <span class=\"k\">}</span><span class=\"k\">;</span>","        <span class=\"k\">this</span><span class=\"k\">.</span>redo <span class=\"k\">=</span> <span class=\"k\">function</span> <span class=\"k\">()</span> <span class=\"k\">{</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span><span class=\"k\">this</span><span class=\"k\">.</span>hasRedo<span class=\"k\">)</span> <span class=\"k\">{</span>","                <span class=\"k\">while</span> <span class=\"k\">(</span><span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">[</span><span class=\"k\">this</span><span class=\"k\">.</span>index<span class=\"k\">].</span>content <span class=\"k\">==</span> <span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">[</span><span class=\"k\">this</span><span class=\"k\">.</span>index <span class=\"k\">+</span> <span class=\"s\">1</span><span class=\"k\">].</span>content<span class=\"k\">)</span> <span class=\"k\">{</span>","                    <span class=\"k\">this</span><span class=\"k\">.</span>index<span class=\"k\">++;</span>","                    <span class=\"k\">if</span> <span class=\"k\">(</span><span class=\"k\">this</span><span class=\"k\">.</span>index <span class=\"k\">==</span> <span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">.</span>length <span class=\"k\">-</span> <span class=\"s\">1</span><span class=\"k\">)</span> <span class=\"k\">{</span>","                        <span class=\"k\">return</span> <span class=\"k\">this</span><span class=\"k\">.</span>restore<span class=\"k\">(</span><span class=\"k\">this</span><span class=\"k\">.</span>index<span class=\"k\">);</span>","                    <span class=\"k\">}</span>","                <span class=\"k\">}</span>","                <span class=\"k\">this</span><span class=\"k\">.</span>restore<span class=\"k\">(++</span><span class=\"k\">this</span><span class=\"k\">.</span>index<span class=\"k\">);</span>","            <span class=\"k\">}</span>","        <span class=\"k\">}</span><span class=\"k\">;</span>","","        <span class=\"k\">this</span><span class=\"k\">.</span>restore <span class=\"k\">=</span> <span class=\"k\">function</span> <span class=\"k\">()</span> <span class=\"k\">{</span>","            <span class=\"k\">var</span> scene <span class=\"k\">=</span> <span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">[</span><span class=\"k\">this</span><span class=\"k\">.</span>index<span class=\"k\">];</span>","            <span class=\"c\">//trace:873</span>","            <span class=\"c\">//&#21435;&#25481;&#23637;&#20301;&#31526;</span>","            me<span class=\"k\">.</span>document<span class=\"k\">.</span>body<span class=\"k\">.</span>innerHTML <span class=\"k\">=</span> scene<span class=\"k\">.</span>content<span class=\"k\">.</span>replace<span class=\"k\">(</span>fillchar<span class=\"k\">,</span> <span class=\"s\">''</span><span class=\"k\">);</span>","            <span class=\"c\">//&#22788;&#29702;undo&#21518;&#31354;&#26684;&#19981;&#23637;&#20301;&#30340;&#38382;&#39064;</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span>browser<span class=\"k\">.</span>ie<span class=\"k\">)</span> <span class=\"k\">{</span>","                utils<span class=\"k\">.</span>each<span class=\"k\">(</span>domUtils<span class=\"k\">.</span>getElementsByTagName<span class=\"k\">(</span>me<span class=\"k\">.</span>document<span class=\"k\">,</span><span class=\"s\">'td th caption p'</span><span class=\"k\">),</span><span class=\"k\">function</span><span class=\"k\">(</span>node<span class=\"k\">)</span><span class=\"k\">{</span>","                    <span class=\"k\">if</span><span class=\"k\">(</span>domUtils<span class=\"k\">.</span>isEmptyNode<span class=\"k\">(</span>node<span class=\"k\">))</span><span class=\"k\">{</span>","                        domUtils<span class=\"k\">.</span>fillNode<span class=\"k\">(</span>me<span class=\"k\">.</span>document<span class=\"k\">,</span> node<span class=\"k\">);</span>","                    <span class=\"k\">}</span>","                <span class=\"k\">}</span><span class=\"k\">)</span>","            <span class=\"k\">}</span>","            <span class=\"k\">new</span> dom<span class=\"k\">.</span>Range<span class=\"k\">(</span>me<span class=\"k\">.</span>document<span class=\"k\">).</span>moveToAddress<span class=\"k\">(</span>scene<span class=\"k\">.</span>address<span class=\"k\">).</span>select<span class=\"k\">();</span>","            <span class=\"k\">this</span><span class=\"k\">.</span>update<span class=\"k\">();</span>","            <span class=\"k\">this</span><span class=\"k\">.</span>clearKey<span class=\"k\">();</span>","            <span class=\"c\">//&#19981;&#33021;&#25226;&#33258;&#24049;reset&#20102;</span>","            me<span class=\"k\">.</span>fireEvent<span class=\"k\">(</span><span class=\"s\">'reset'</span><span class=\"k\">,</span> <span class=\"k\">true</span><span class=\"k\">);</span>","        <span class=\"k\">}</span><span class=\"k\">;</span>","","        <span class=\"k\">this</span><span class=\"k\">.</span>getScene <span class=\"k\">=</span> <span class=\"k\">function</span> <span class=\"k\">()</span> <span class=\"k\">{</span>","            <span class=\"k\">var</span> rng <span class=\"k\">=</span> me<span class=\"k\">.</span>selection<span class=\"k\">.</span>getRange<span class=\"k\">(),</span>","                restoreAddress <span class=\"k\">=</span> rng<span class=\"k\">.</span>createAddress<span class=\"k\">(),</span>","                rngAddress <span class=\"k\">=</span> rng<span class=\"k\">.</span>createAddress<span class=\"k\">(</span><span class=\"k\">false</span><span class=\"k\">,</span><span class=\"k\">true</span><span class=\"k\">);</span>","","            me<span class=\"k\">.</span>fireEvent<span class=\"k\">(</span><span class=\"s\">'beforegetscene'</span><span class=\"k\">);</span>","            <span class=\"k\">var</span> cont <span class=\"k\">=</span> me<span class=\"k\">.</span>body<span class=\"k\">.</span>innerHTML<span class=\"k\">.</span>replace<span class=\"k\">(</span>fillchar<span class=\"k\">,</span> <span class=\"s\">''</span><span class=\"k\">);</span>","            browser<span class=\"k\">.</span>ie <span class=\"k\">&amp;&amp;</span> <span class=\"k\">(</span>cont <span class=\"k\">=</span> cont<span class=\"k\">.</span>replace<span class=\"k\">(</span><span class=\"s\">/&gt;&amp;nbsp;&lt;/g</span><span class=\"k\">,</span> <span class=\"s\">'&gt;&lt;'</span><span class=\"k\">).</span>replace<span class=\"k\">(</span><span class=\"s\">/\\s*&lt;/g</span><span class=\"k\">,</span> <span class=\"s\">'&lt;'</span><span class=\"k\">).</span>replace<span class=\"k\">(</span><span class=\"s\">/&gt;\\s*/g</span><span class=\"k\">,</span> <span class=\"s\">'&gt;'</span><span class=\"k\">));</span>","            me<span class=\"k\">.</span>fireEvent<span class=\"k\">(</span><span class=\"s\">'aftergetscene'</span><span class=\"k\">);</span>","            <span class=\"k\">try</span><span class=\"k\">{</span>","                rng<span class=\"k\">.</span>moveToAddress<span class=\"k\">(</span>restoreAddress<span class=\"k\">).</span>select<span class=\"k\">(</span><span class=\"k\">true</span><span class=\"k\">);</span>","            <span class=\"k\">}</span><span class=\"k\">catch</span><span class=\"k\">(</span>e<span class=\"k\">)</span><span class=\"k\">{}</span>","            <span class=\"k\">return</span> <span class=\"k\">{</span>","                address<span class=\"k\">:</span>rngAddress<span class=\"k\">,</span>","                content<span class=\"k\">:</span>cont","            <span class=\"k\">}</span>","        <span class=\"k\">}</span><span class=\"k\">;</span>","        <span class=\"k\">this</span><span class=\"k\">.</span>save <span class=\"k\">=</span> <span class=\"k\">function</span> <span class=\"k\">(</span>notCompareRange<span class=\"k\">)</span> <span class=\"k\">{</span>","            <span class=\"k\">var</span> currentScene <span class=\"k\">=</span> <span class=\"k\">this</span><span class=\"k\">.</span>getScene<span class=\"k\">(),</span>","                lastScene <span class=\"k\">=</span> <span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">[</span><span class=\"k\">this</span><span class=\"k\">.</span>index<span class=\"k\">];</span>","            <span class=\"c\">//&#20869;&#23481;&#30456;&#21516;&#20301;&#32622;&#30456;&#21516;&#19981;&#23384;</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span>lastScene <span class=\"k\">&amp;&amp;</span> lastScene<span class=\"k\">.</span>content <span class=\"k\">==</span> currentScene<span class=\"k\">.</span>content <span class=\"k\">&amp;&amp;</span>","                <span class=\"k\">(</span> notCompareRange <span class=\"k\">?</span> <span class=\"s\">1</span> <span class=\"k\">:</span> compareRangeAddress<span class=\"k\">(</span>lastScene<span class=\"k\">.</span>address<span class=\"k\">,</span> currentScene<span class=\"k\">.</span>address<span class=\"k\">)</span> <span class=\"k\">)</span>","                <span class=\"k\">)</span> <span class=\"k\">{</span>","                <span class=\"k\">return</span><span class=\"k\">;</span>","            <span class=\"k\">}</span>","            <span class=\"k\">this</span><span class=\"k\">.</span>list <span class=\"k\">=</span> <span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">.</span>slice<span class=\"k\">(</span><span class=\"s\">0</span><span class=\"k\">,</span> <span class=\"k\">this</span><span class=\"k\">.</span>index <span class=\"k\">+</span> <span class=\"s\">1</span><span class=\"k\">);</span>","            <span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">.</span>push<span class=\"k\">(</span>currentScene<span class=\"k\">);</span>","            <span class=\"c\">//&#22914;&#26524;&#22823;&#20110;&#26368;&#22823;&#25968;&#37327;&#20102;&#65292;&#23601;&#25226;&#26368;&#21069;&#30340;&#21076;&#38500;</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span><span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">.</span>length <span class=\"k\">&gt;</span> maxUndoCount<span class=\"k\">)</span> <span class=\"k\">{</span>","                <span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">.</span>shift<span class=\"k\">();</span>","            <span class=\"k\">}</span>","            <span class=\"k\">this</span><span class=\"k\">.</span>index <span class=\"k\">=</span> <span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">.</span>length <span class=\"k\">-</span> <span class=\"s\">1</span><span class=\"k\">;</span>","            <span class=\"k\">this</span><span class=\"k\">.</span>clearKey<span class=\"k\">();</span>","            <span class=\"c\">//&#36319;&#26032;undo/redo&#29366;&#24577;</span>","            <span class=\"k\">this</span><span class=\"k\">.</span>update<span class=\"k\">();</span>","        <span class=\"k\">}</span><span class=\"k\">;</span>","        <span class=\"k\">this</span><span class=\"k\">.</span>update <span class=\"k\">=</span> <span class=\"k\">function</span> <span class=\"k\">()</span> <span class=\"k\">{</span>","            <span class=\"k\">this</span><span class=\"k\">.</span>hasRedo <span class=\"k\">=</span> <span class=\"k\">!!</span><span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">[</span><span class=\"k\">this</span><span class=\"k\">.</span>index <span class=\"k\">+</span> <span class=\"s\">1</span><span class=\"k\">];</span>","            <span class=\"k\">this</span><span class=\"k\">.</span>hasUndo <span class=\"k\">=</span> <span class=\"k\">!!</span><span class=\"k\">this</span><span class=\"k\">.</span>list<span class=\"k\">[</span><span class=\"k\">this</span><span class=\"k\">.</span>index <span class=\"k\">-</span> <span class=\"s\">1</span><span class=\"k\">];</span>","        <span class=\"k\">}</span><span class=\"k\">;</span>","        <span class=\"k\">this</span><span class=\"k\">.</span>reset <span class=\"k\">=</span> <span class=\"k\">function</span> <span class=\"k\">()</span> <span class=\"k\">{</span>","            <span class=\"k\">this</span><span class=\"k\">.</span>list <span class=\"k\">=</span> <span class=\"k\">[];</span>","            <span class=\"k\">this</span><span class=\"k\">.</span>index <span class=\"k\">=</span> <span class=\"s\">0</span><span class=\"k\">;</span>","            <span class=\"k\">this</span><span class=\"k\">.</span>hasUndo <span class=\"k\">=</span> <span class=\"k\">false</span><span class=\"k\">;</span>","            <span class=\"k\">this</span><span class=\"k\">.</span>hasRedo <span class=\"k\">=</span> <span class=\"k\">false</span><span class=\"k\">;</span>","            <span class=\"k\">this</span><span class=\"k\">.</span>clearKey<span class=\"k\">();</span>","        <span class=\"k\">}</span><span class=\"k\">;</span>","        <span class=\"k\">this</span><span class=\"k\">.</span>clearKey <span class=\"k\">=</span> <span class=\"k\">function</span> <span class=\"k\">()</span> <span class=\"k\">{</span>","            keycont <span class=\"k\">=</span> <span class=\"s\">0</span><span class=\"k\">;</span>","            lastKeyCode <span class=\"k\">=</span> <span class=\"k\">null</span><span class=\"k\">;</span>","        <span class=\"k\">}</span><span class=\"k\">;</span>","    <span class=\"k\">}</span>","","    me<span class=\"k\">.</span>undoManger <span class=\"k\">=</span> <span class=\"k\">new</span> UndoManager<span class=\"k\">();</span>","    <span class=\"k\">function</span> saveScene<span class=\"k\">()</span> <span class=\"k\">{</span>","        <span class=\"k\">this</span><span class=\"k\">.</span>undoManger<span class=\"k\">.</span>save<span class=\"k\">();</span>","    <span class=\"k\">}</span>","","    me<span class=\"k\">.</span>addListener<span class=\"k\">(</span><span class=\"s\">'saveScene'</span><span class=\"k\">,</span> <span class=\"k\">function</span> <span class=\"k\">()</span> <span class=\"k\">{</span>","        me<span class=\"k\">.</span>undoManger<span class=\"k\">.</span>save<span class=\"k\">();</span>","    <span class=\"k\">}</span><span class=\"k\">);</span>","","    me<span class=\"k\">.</span>addListener<span class=\"k\">(</span><span class=\"s\">'beforeexeccommand'</span><span class=\"k\">,</span> saveScene<span class=\"k\">);</span>","    me<span class=\"k\">.</span>addListener<span class=\"k\">(</span><span class=\"s\">'afterexeccommand'</span><span class=\"k\">,</span> saveScene<span class=\"k\">);</span>","","    me<span class=\"k\">.</span>addListener<span class=\"k\">(</span><span class=\"s\">'reset'</span><span class=\"k\">,</span> <span class=\"k\">function</span> <span class=\"k\">(</span>type<span class=\"k\">,</span> exclude<span class=\"k\">)</span> <span class=\"k\">{</span>","        <span class=\"k\">if</span> <span class=\"k\">(!</span>exclude<span class=\"k\">)</span> <span class=\"k\">{</span>","            me<span class=\"k\">.</span>undoManger<span class=\"k\">.</span>reset<span class=\"k\">();</span>","        <span class=\"k\">}</span>","    <span class=\"k\">}</span><span class=\"k\">);</span>","    me<span class=\"k\">.</span>commands<span class=\"k\">[</span><span class=\"s\">'redo'</span><span class=\"k\">]</span> <span class=\"k\">=</span> me<span class=\"k\">.</span>commands<span class=\"k\">[</span><span class=\"s\">'undo'</span><span class=\"k\">]</span> <span class=\"k\">=</span> <span class=\"k\">{</span>","        execCommand<span class=\"k\">:</span><span class=\"k\">function</span> <span class=\"k\">(</span>cmdName<span class=\"k\">)</span> <span class=\"k\">{</span>","            me<span class=\"k\">.</span>undoManger<span class=\"k\">[</span>cmdName<span class=\"k\">]();</span>","        <span class=\"k\">}</span><span class=\"k\">,</span>","        queryCommandState<span class=\"k\">:</span><span class=\"k\">function</span> <span class=\"k\">(</span>cmdName<span class=\"k\">)</span> <span class=\"k\">{</span>","            <span class=\"k\">return</span> me<span class=\"k\">.</span>undoManger<span class=\"k\">[</span><span class=\"s\">'has'</span> <span class=\"k\">+</span> <span class=\"k\">(</span>cmdName<span class=\"k\">.</span>toLowerCase<span class=\"k\">()</span> <span class=\"k\">==</span> <span class=\"s\">'undo'</span> <span class=\"k\">?</span> <span class=\"s\">'Undo'</span> <span class=\"k\">:</span> <span class=\"s\">'Redo'</span><span class=\"k\">)]</span> <span class=\"k\">?</span> <span class=\"s\">0</span> <span class=\"k\">:</span> <span class=\"k\">-</span><span class=\"s\">1</span><span class=\"k\">;</span>","        <span class=\"k\">}</span><span class=\"k\">,</span>","        notNeedUndo<span class=\"k\">:</span><span class=\"s\">1</span>","    <span class=\"k\">}</span><span class=\"k\">;</span>","","    <span class=\"k\">var</span> keys <span class=\"k\">=</span> <span class=\"k\">{</span>","            <span class=\"c\">//  /*Backspace*/ 8:1, /*Delete*/ 46:1,</span>","            <span class=\"c\">/*Shift*/</span> <span class=\"s\">16</span><span class=\"k\">:</span><span class=\"s\">1</span><span class=\"k\">,</span> <span class=\"c\">/*Ctrl*/</span> <span class=\"s\">17</span><span class=\"k\">:</span><span class=\"s\">1</span><span class=\"k\">,</span> <span class=\"c\">/*Alt*/</span> <span class=\"s\">18</span><span class=\"k\">:</span><span class=\"s\">1</span><span class=\"k\">,</span>","            <span class=\"s\">37</span><span class=\"k\">:</span><span class=\"s\">1</span><span class=\"k\">,</span> <span class=\"s\">38</span><span class=\"k\">:</span><span class=\"s\">1</span><span class=\"k\">,</span> <span class=\"s\">39</span><span class=\"k\">:</span><span class=\"s\">1</span><span class=\"k\">,</span> <span class=\"s\">40</span><span class=\"k\">:</span><span class=\"s\">1</span><span class=\"k\">,</span>","            <span class=\"s\">13</span><span class=\"k\">:</span><span class=\"s\">1</span> <span class=\"c\">/*enter*/</span>","        <span class=\"k\">}</span><span class=\"k\">,</span>","        keycont <span class=\"k\">=</span> <span class=\"s\">0</span><span class=\"k\">,</span>","        lastKeyCode<span class=\"k\">;</span>","    <span class=\"c\">//&#36755;&#20837;&#27861;&#29366;&#24577;&#19979;&#19981;&#35745;&#31639;&#23383;&#31526;&#25968;</span>","    <span class=\"k\">var</span> inputType <span class=\"k\">=</span> <span class=\"k\">false</span><span class=\"k\">;</span>","    me<span class=\"k\">.</span>addListener<span class=\"k\">(</span><span class=\"s\">'ready'</span><span class=\"k\">,</span> <span class=\"k\">function</span> <span class=\"k\">()</span> <span class=\"k\">{</span>","        domUtils<span class=\"k\">.</span>on<span class=\"k\">(</span>me<span class=\"k\">.</span>body<span class=\"k\">,</span> <span class=\"s\">'compositionstart'</span><span class=\"k\">,</span> <span class=\"k\">function</span> <span class=\"k\">()</span> <span class=\"k\">{</span>","            inputType <span class=\"k\">=</span> <span class=\"k\">true</span><span class=\"k\">;</span>","        <span class=\"k\">}</span><span class=\"k\">);</span>","        domUtils<span class=\"k\">.</span>on<span class=\"k\">(</span>me<span class=\"k\">.</span>body<span class=\"k\">,</span> <span class=\"s\">'compositionend'</span><span class=\"k\">,</span> <span class=\"k\">function</span> <span class=\"k\">()</span> <span class=\"k\">{</span>","            inputType <span class=\"k\">=</span> <span class=\"k\">false</span><span class=\"k\">;</span>","        <span class=\"k\">}</span><span class=\"k\">)</span>","    <span class=\"k\">}</span><span class=\"k\">);</span>","    <span class=\"c\">//&#24555;&#25463;&#38190;</span>","    me<span class=\"k\">.</span>addshortcutkey<span class=\"k\">(</span><span class=\"k\">{</span>","        <span class=\"s\">\"Undo\"</span><span class=\"k\">:</span><span class=\"s\">\"ctrl+90\"</span><span class=\"k\">,</span> <span class=\"c\">//undo</span>","        <span class=\"s\">\"Redo\"</span><span class=\"k\">:</span><span class=\"s\">\"ctrl+89\"</span> <span class=\"c\">//redo</span>","","    <span class=\"k\">}</span><span class=\"k\">);</span>","    me<span class=\"k\">.</span>addListener<span class=\"k\">(</span><span class=\"s\">'keydown'</span><span class=\"k\">,</span> <span class=\"k\">function</span> <span class=\"k\">(</span>type<span class=\"k\">,</span> evt<span class=\"k\">)</span> <span class=\"k\">{</span>","        <span class=\"k\">var</span> keyCode <span class=\"k\">=</span> evt<span class=\"k\">.</span>keyCode <span class=\"k\">||</span> evt<span class=\"k\">.</span>which<span class=\"k\">;</span>","        <span class=\"k\">if</span> <span class=\"k\">(!</span>keys<span class=\"k\">[</span>keyCode<span class=\"k\">]</span> <span class=\"k\">&amp;&amp;</span> <span class=\"k\">!</span>evt<span class=\"k\">.</span>ctrlKey <span class=\"k\">&amp;&amp;</span> <span class=\"k\">!</span>evt<span class=\"k\">.</span>metaKey <span class=\"k\">&amp;&amp;</span> <span class=\"k\">!</span>evt<span class=\"k\">.</span>shiftKey <span class=\"k\">&amp;&amp;</span> <span class=\"k\">!</span>evt<span class=\"k\">.</span>altKey<span class=\"k\">)</span> <span class=\"k\">{</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span>inputType<span class=\"k\">)</span>","                <span class=\"k\">return</span><span class=\"k\">;</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span>me<span class=\"k\">.</span>undoManger<span class=\"k\">.</span>list<span class=\"k\">.</span>length <span class=\"k\">==</span> <span class=\"s\">0</span> <span class=\"k\">||</span> <span class=\"k\">((</span>keyCode <span class=\"k\">==</span> <span class=\"s\">8</span> <span class=\"k\">||</span> keyCode <span class=\"k\">==</span> <span class=\"s\">46</span><span class=\"k\">)</span> <span class=\"k\">&amp;&amp;</span> lastKeyCode <span class=\"k\">!=</span> keyCode<span class=\"k\">))</span> <span class=\"k\">{</span>","                me<span class=\"k\">.</span>fireEvent<span class=\"k\">(</span><span class=\"s\">'contentchange'</span><span class=\"k\">);</span>","                me<span class=\"k\">.</span>undoManger<span class=\"k\">.</span>save<span class=\"k\">(</span><span class=\"k\">true</span><span class=\"k\">);</span>","                lastKeyCode <span class=\"k\">=</span> keyCode<span class=\"k\">;</span>","                <span class=\"k\">return</span><span class=\"k\">;</span>","            <span class=\"k\">}</span>","            <span class=\"c\">//trace:856</span>","            <span class=\"c\">//&#20462;&#27491;&#31532;&#19968;&#27425;&#36755;&#20837;&#21518;&#65292;&#22238;&#36864;&#65292;&#20877;&#36755;&#20837;&#35201;&#21040;keycont&gt;maxInputCount&#25165;&#33021;&#22312;&#22238;&#36864;&#30340;&#38382;&#39064;</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span>me<span class=\"k\">.</span>undoManger<span class=\"k\">.</span>list<span class=\"k\">.</span>length <span class=\"k\">==</span> <span class=\"s\">2</span> <span class=\"k\">&amp;&amp;</span> me<span class=\"k\">.</span>undoManger<span class=\"k\">.</span>index <span class=\"k\">==</span> <span class=\"s\">0</span> <span class=\"k\">&amp;&amp;</span> keycont <span class=\"k\">==</span> <span class=\"s\">0</span><span class=\"k\">)</span> <span class=\"k\">{</span>","                me<span class=\"k\">.</span>undoManger<span class=\"k\">.</span>list<span class=\"k\">.</span>splice<span class=\"k\">(</span><span class=\"s\">1</span><span class=\"k\">,</span> <span class=\"s\">1</span><span class=\"k\">);</span>","                me<span class=\"k\">.</span>undoManger<span class=\"k\">.</span>update<span class=\"k\">();</span>","            <span class=\"k\">}</span>","            lastKeyCode <span class=\"k\">=</span> keyCode<span class=\"k\">;</span>","            keycont<span class=\"k\">++;</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span>keycont <span class=\"k\">&gt;=</span> maxInputCount <span class=\"k\">||</span> me<span class=\"k\">.</span>undoManger<span class=\"k\">.</span>mousedown<span class=\"k\">)</span> <span class=\"k\">{</span>","                <span class=\"k\">if</span> <span class=\"k\">(</span>me<span class=\"k\">.</span>selection<span class=\"k\">.</span>getRange<span class=\"k\">().</span>collapsed<span class=\"k\">)</span>","                    me<span class=\"k\">.</span>fireEvent<span class=\"k\">(</span><span class=\"s\">'contentchange'</span><span class=\"k\">);</span>","                me<span class=\"k\">.</span>undoManger<span class=\"k\">.</span>save<span class=\"k\">();</span>","                me<span class=\"k\">.</span>undoManger<span class=\"k\">.</span>mousedown <span class=\"k\">=</span> <span class=\"k\">false</span><span class=\"k\">;</span>","            <span class=\"k\">}</span>","        <span class=\"k\">}</span>","    <span class=\"k\">}</span><span class=\"k\">);</span>","    me<span class=\"k\">.</span>addListener<span class=\"k\">(</span><span class=\"s\">'keyup'</span><span class=\"k\">,</span> <span class=\"k\">function</span> <span class=\"k\">(</span>type<span class=\"k\">,</span> evt<span class=\"k\">)</span> <span class=\"k\">{</span>","        <span class=\"k\">var</span> keyCode <span class=\"k\">=</span> evt<span class=\"k\">.</span>keyCode <span class=\"k\">||</span> evt<span class=\"k\">.</span>which<span class=\"k\">;</span>","        <span class=\"k\">if</span> <span class=\"k\">(!</span>keys<span class=\"k\">[</span>keyCode<span class=\"k\">]</span> <span class=\"k\">&amp;&amp;</span> <span class=\"k\">!</span>evt<span class=\"k\">.</span>ctrlKey <span class=\"k\">&amp;&amp;</span> <span class=\"k\">!</span>evt<span class=\"k\">.</span>metaKey <span class=\"k\">&amp;&amp;</span> <span class=\"k\">!</span>evt<span class=\"k\">.</span>shiftKey <span class=\"k\">&amp;&amp;</span> <span class=\"k\">!</span>evt<span class=\"k\">.</span>altKey<span class=\"k\">)</span> <span class=\"k\">{</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span>inputType<span class=\"k\">)</span>","                <span class=\"k\">return</span><span class=\"k\">;</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span>me<span class=\"k\">.</span>undoManger<span class=\"k\">.</span>list<span class=\"k\">.</span>length <span class=\"k\">==</span> <span class=\"s\">1</span>  <span class=\"k\">)</span> <span class=\"k\">{</span>","                me<span class=\"k\">.</span>undoManger<span class=\"k\">.</span>save<span class=\"k\">(</span><span class=\"k\">true</span><span class=\"k\">);</span>","            <span class=\"k\">}</span>","","","        <span class=\"k\">}</span>","    <span class=\"k\">}</span><span class=\"k\">);</span>","    me<span class=\"k\">.</span>addListener<span class=\"k\">(</span><span class=\"s\">'mousedown'</span><span class=\"k\">,</span><span class=\"k\">function</span><span class=\"k\">()</span><span class=\"k\">{</span>","        me<span class=\"k\">.</span>undoManger<span class=\"k\">.</span>mousedown <span class=\"k\">=</span> <span class=\"k\">true</span><span class=\"k\">;</span>","    <span class=\"k\">}</span><span class=\"k\">)</span>","<span class=\"k\">}</span><span class=\"k\">;</span>"];
_$jscoverage['plugins/undo.js'][10]++;
UE.plugins.undo = (function () {
  _$jscoverage['plugins/undo.js'][11]++;
  var me = this, maxUndoCount = (me.options.maxUndoCount || 20), maxInputCount = (me.options.maxInputCount || 20), fillchar = new RegExp((domUtils.fillChar + "|</hr>"), "gi");
  _$jscoverage['plugins/undo.js'][17]++;
  function compareAddr(indexA, indexB) {
    _$jscoverage['plugins/undo.js'][18]++;
    if ((indexA.length != indexB.length)) {
      _$jscoverage['plugins/undo.js'][19]++;
      return 0;
    }
    _$jscoverage['plugins/undo.js'][20]++;
    for (var i = 0, l = indexA.length; (i < l); (i++)) {
      _$jscoverage['plugins/undo.js'][21]++;
      if ((indexA[i] != indexB[i])) {
        _$jscoverage['plugins/undo.js'][22]++;
        return 0;
      }
}
    _$jscoverage['plugins/undo.js'][24]++;
    return 1;
}
  _$jscoverage['plugins/undo.js'][27]++;
  function compareRangeAddress(rngAddrA, rngAddrB) {
    _$jscoverage['plugins/undo.js'][28]++;
    if ((rngAddrA.collapsed != rngAddrB.collapsed)) {
      _$jscoverage['plugins/undo.js'][29]++;
      return 0;
    }
    _$jscoverage['plugins/undo.js'][31]++;
    if (((! compareAddr(rngAddrA.startAddress, rngAddrB.startAddress)) || (! compareAddr(rngAddrA.endAddress, rngAddrB.endAddress)))) {
      _$jscoverage['plugins/undo.js'][32]++;
      return 0;
    }
    _$jscoverage['plugins/undo.js'][34]++;
    return 1;
}
  _$jscoverage['plugins/undo.js'][37]++;
  function adjustContent(cont) {
    _$jscoverage['plugins/undo.js'][38]++;
    var specialAttr = /\b(?:href|src|name)="[^"]*?"/gi;
    _$jscoverage['plugins/undo.js'][39]++;
    return cont.replace(specialAttr, "").replace(/([\w\-]*?)\s*=\s*(("([^"]*)")|('([^']*)')|([^\s>]+))/gi, (function (a, b, c) {
  _$jscoverage['plugins/undo.js'][41]++;
  return (b.toLowerCase() + "=" + c.replace(/['"]/g, "").toLowerCase());
})).replace(/(<[\w\-]+)|([\w\-]+>)/gi, (function (a, b, c) {
  _$jscoverage['plugins/undo.js'][44]++;
  return (b || c).toLowerCase();
}));
}
  _$jscoverage['plugins/undo.js'][48]++;
  function UndoManager() {
    _$jscoverage['plugins/undo.js'][49]++;
    this.list = [];
    _$jscoverage['plugins/undo.js'][50]++;
    this.index = 0;
    _$jscoverage['plugins/undo.js'][51]++;
    this.hasUndo = false;
    _$jscoverage['plugins/undo.js'][52]++;
    this.hasRedo = false;
    _$jscoverage['plugins/undo.js'][53]++;
    this.undo = (function () {
  _$jscoverage['plugins/undo.js'][54]++;
  if (this.hasUndo) {
    _$jscoverage['plugins/undo.js'][55]++;
    var currentScene = this.getScene(), lastScene = this.list[this.index], lastContent = adjustContent(lastScene.content), currentContent = adjustContent(currentScene.content);
    _$jscoverage['plugins/undo.js'][60]++;
    if ((lastContent != currentContent)) {
      _$jscoverage['plugins/undo.js'][61]++;
      this.save();
    }
    _$jscoverage['plugins/undo.js'][63]++;
    if (((! this.list[(this.index - 1)]) && (this.list.length == 1))) {
      _$jscoverage['plugins/undo.js'][64]++;
      this.reset();
      _$jscoverage['plugins/undo.js'][65]++;
      return;
    }
    _$jscoverage['plugins/undo.js'][67]++;
    while ((this.list[this.index].content == this.list[(this.index - 1)].content)) {
      _$jscoverage['plugins/undo.js'][68]++;
      (this.index--);
      _$jscoverage['plugins/undo.js'][69]++;
      if ((this.index == 0)) {
        _$jscoverage['plugins/undo.js'][70]++;
        return this.restore(0);
      }
}
    _$jscoverage['plugins/undo.js'][73]++;
    this.restore((--this.index));
  }
});
    _$jscoverage['plugins/undo.js'][76]++;
    this.redo = (function () {
  _$jscoverage['plugins/undo.js'][77]++;
  if (this.hasRedo) {
    _$jscoverage['plugins/undo.js'][78]++;
    while ((this.list[this.index].content == this.list[(this.index + 1)].content)) {
      _$jscoverage['plugins/undo.js'][79]++;
      (this.index++);
      _$jscoverage['plugins/undo.js'][80]++;
      if ((this.index == (this.list.length - 1))) {
        _$jscoverage['plugins/undo.js'][81]++;
        return this.restore(this.index);
      }
}
    _$jscoverage['plugins/undo.js'][84]++;
    this.restore((++this.index));
  }
});
    _$jscoverage['plugins/undo.js'][88]++;
    this.restore = (function () {
  _$jscoverage['plugins/undo.js'][89]++;
  var scene = this.list[this.index];
  _$jscoverage['plugins/undo.js'][92]++;
  me.document.body.innerHTML = scene.content.replace(fillchar, "");
  _$jscoverage['plugins/undo.js'][94]++;
  if (browser.ie) {
    _$jscoverage['plugins/undo.js'][95]++;
    utils.each(domUtils.getElementsByTagName(me.document, "td th caption p"), (function (node) {
  _$jscoverage['plugins/undo.js'][96]++;
  if (domUtils.isEmptyNode(node)) {
    _$jscoverage['plugins/undo.js'][97]++;
    domUtils.fillNode(me.document, node);
  }
}));
  }
  _$jscoverage['plugins/undo.js'][101]++;
  new (dom.Range)(me.document).moveToAddress(scene.address).select();
  _$jscoverage['plugins/undo.js'][102]++;
  this.update();
  _$jscoverage['plugins/undo.js'][103]++;
  this.clearKey();
  _$jscoverage['plugins/undo.js'][105]++;
  me.fireEvent("reset", true);
});
    _$jscoverage['plugins/undo.js'][108]++;
    this.getScene = (function () {
  _$jscoverage['plugins/undo.js'][109]++;
  var rng = me.selection.getRange(), restoreAddress = rng.createAddress(), rngAddress = rng.createAddress(false, true);
  _$jscoverage['plugins/undo.js'][113]++;
  me.fireEvent("beforegetscene");
  _$jscoverage['plugins/undo.js'][114]++;
  var cont = me.body.innerHTML.replace(fillchar, "");
  _$jscoverage['plugins/undo.js'][115]++;
  (browser.ie && (cont = cont.replace(/>&nbsp;</g, "><").replace(/\s*</g, "<").replace(/>\s*/g, ">")));
  _$jscoverage['plugins/undo.js'][116]++;
  me.fireEvent("aftergetscene");
  _$jscoverage['plugins/undo.js'][117]++;
  try {
    _$jscoverage['plugins/undo.js'][118]++;
    rng.moveToAddress(restoreAddress).select(true);
  }
  catch (e) {
  }
  _$jscoverage['plugins/undo.js'][120]++;
  return ({address: rngAddress, content: cont});
});
    _$jscoverage['plugins/undo.js'][125]++;
    this.save = (function (notCompareRange) {
  _$jscoverage['plugins/undo.js'][126]++;
  var currentScene = this.getScene(), lastScene = this.list[this.index];
  _$jscoverage['plugins/undo.js'][129]++;
  if ((lastScene && (lastScene.content == currentScene.content) && (notCompareRange? 1: compareRangeAddress(lastScene.address, currentScene.address)))) {
    _$jscoverage['plugins/undo.js'][132]++;
    return;
  }
  _$jscoverage['plugins/undo.js'][134]++;
  this.list = this.list.slice(0, (this.index + 1));
  _$jscoverage['plugins/undo.js'][135]++;
  this.list.push(currentScene);
  _$jscoverage['plugins/undo.js'][137]++;
  if ((this.list.length > maxUndoCount)) {
    _$jscoverage['plugins/undo.js'][138]++;
    this.list.shift();
  }
  _$jscoverage['plugins/undo.js'][140]++;
  this.index = (this.list.length - 1);
  _$jscoverage['plugins/undo.js'][141]++;
  this.clearKey();
  _$jscoverage['plugins/undo.js'][143]++;
  this.update();
});
    _$jscoverage['plugins/undo.js'][145]++;
    this.update = (function () {
  _$jscoverage['plugins/undo.js'][146]++;
  this.hasRedo = (! (! this.list[(this.index + 1)]));
  _$jscoverage['plugins/undo.js'][147]++;
  this.hasUndo = (! (! this.list[(this.index - 1)]));
});
    _$jscoverage['plugins/undo.js'][149]++;
    this.reset = (function () {
  _$jscoverage['plugins/undo.js'][150]++;
  this.list = [];
  _$jscoverage['plugins/undo.js'][151]++;
  this.index = 0;
  _$jscoverage['plugins/undo.js'][152]++;
  this.hasUndo = false;
  _$jscoverage['plugins/undo.js'][153]++;
  this.hasRedo = false;
  _$jscoverage['plugins/undo.js'][154]++;
  this.clearKey();
});
    _$jscoverage['plugins/undo.js'][156]++;
    this.clearKey = (function () {
  _$jscoverage['plugins/undo.js'][157]++;
  keycont = 0;
  _$jscoverage['plugins/undo.js'][158]++;
  lastKeyCode = null;
});
}
  _$jscoverage['plugins/undo.js'][162]++;
  me.undoManger = new UndoManager();
  _$jscoverage['plugins/undo.js'][163]++;
  function saveScene() {
    _$jscoverage['plugins/undo.js'][164]++;
    this.undoManger.save();
}
  _$jscoverage['plugins/undo.js'][167]++;
  me.addListener("saveScene", (function () {
  _$jscoverage['plugins/undo.js'][168]++;
  me.undoManger.save();
}));
  _$jscoverage['plugins/undo.js'][171]++;
  me.addListener("beforeexeccommand", saveScene);
  _$jscoverage['plugins/undo.js'][172]++;
  me.addListener("afterexeccommand", saveScene);
  _$jscoverage['plugins/undo.js'][174]++;
  me.addListener("reset", (function (type, exclude) {
  _$jscoverage['plugins/undo.js'][175]++;
  if ((! exclude)) {
    _$jscoverage['plugins/undo.js'][176]++;
    me.undoManger.reset();
  }
}));
  _$jscoverage['plugins/undo.js'][179]++;
  me.commands.redo = (me.commands.undo = {execCommand: (function (cmdName) {
  _$jscoverage['plugins/undo.js'][181]++;
  (me.undoManger[cmdName])();
}), queryCommandState: (function (cmdName) {
  _$jscoverage['plugins/undo.js'][184]++;
  return (me.undoManger[("has" + ((cmdName.toLowerCase() == "undo")? "Undo": "Redo"))]? 0: -1);
}), notNeedUndo: 1});
  _$jscoverage['plugins/undo.js'][189]++;
  var keys = {16: 1, 17: 1, 18: 1, 37: 1, 38: 1, 39: 1, 40: 1, 13: 1}, keycont = 0, lastKeyCode;
  _$jscoverage['plugins/undo.js'][198]++;
  var inputType = false;
  _$jscoverage['plugins/undo.js'][199]++;
  me.addListener("ready", (function () {
  _$jscoverage['plugins/undo.js'][200]++;
  domUtils.on(me.body, "compositionstart", (function () {
  _$jscoverage['plugins/undo.js'][201]++;
  inputType = true;
}));
  _$jscoverage['plugins/undo.js'][203]++;
  domUtils.on(me.body, "compositionend", (function () {
  _$jscoverage['plugins/undo.js'][204]++;
  inputType = false;
}));
}));
  _$jscoverage['plugins/undo.js'][208]++;
  me.addshortcutkey({"Undo": "ctrl+90", "Redo": "ctrl+89"});
  _$jscoverage['plugins/undo.js'][213]++;
  me.addListener("keydown", (function (type, evt) {
  _$jscoverage['plugins/undo.js'][214]++;
  var keyCode = (evt.keyCode || evt.which);
  _$jscoverage['plugins/undo.js'][215]++;
  if (((! keys[keyCode]) && (! evt.ctrlKey) && (! evt.metaKey) && (! evt.shiftKey) && (! evt.altKey))) {
    _$jscoverage['plugins/undo.js'][216]++;
    if (inputType) {
      _$jscoverage['plugins/undo.js'][217]++;
      return;
    }
    _$jscoverage['plugins/undo.js'][218]++;
    if (((me.undoManger.list.length == 0) || (((keyCode == 8) || (keyCode == 46)) && (lastKeyCode != keyCode)))) {
      _$jscoverage['plugins/undo.js'][219]++;
      me.fireEvent("contentchange");
      _$jscoverage['plugins/undo.js'][220]++;
      me.undoManger.save(true);
      _$jscoverage['plugins/undo.js'][221]++;
      lastKeyCode = keyCode;
      _$jscoverage['plugins/undo.js'][222]++;
      return;
    }
    _$jscoverage['plugins/undo.js'][226]++;
    if (((me.undoManger.list.length == 2) && (me.undoManger.index == 0) && (keycont == 0))) {
      _$jscoverage['plugins/undo.js'][227]++;
      me.undoManger.list.splice(1, 1);
      _$jscoverage['plugins/undo.js'][228]++;
      me.undoManger.update();
    }
    _$jscoverage['plugins/undo.js'][230]++;
    lastKeyCode = keyCode;
    _$jscoverage['plugins/undo.js'][231]++;
    (keycont++);
    _$jscoverage['plugins/undo.js'][232]++;
    if (((keycont >= maxInputCount) || me.undoManger.mousedown)) {
      _$jscoverage['plugins/undo.js'][233]++;
      if (me.selection.getRange().collapsed) {
        _$jscoverage['plugins/undo.js'][234]++;
        me.fireEvent("contentchange");
      }
      _$jscoverage['plugins/undo.js'][235]++;
      me.undoManger.save();
      _$jscoverage['plugins/undo.js'][236]++;
      me.undoManger.mousedown = false;
    }
  }
}));
  _$jscoverage['plugins/undo.js'][240]++;
  me.addListener("keyup", (function (type, evt) {
  _$jscoverage['plugins/undo.js'][241]++;
  var keyCode = (evt.keyCode || evt.which);
  _$jscoverage['plugins/undo.js'][242]++;
  if (((! keys[keyCode]) && (! evt.ctrlKey) && (! evt.metaKey) && (! evt.shiftKey) && (! evt.altKey))) {
    _$jscoverage['plugins/undo.js'][243]++;
    if (inputType) {
      _$jscoverage['plugins/undo.js'][244]++;
      return;
    }
    _$jscoverage['plugins/undo.js'][245]++;
    if ((me.undoManger.list.length == 1)) {
      _$jscoverage['plugins/undo.js'][246]++;
      me.undoManger.save(true);
    }
  }
}));
  _$jscoverage['plugins/undo.js'][252]++;
  me.addListener("mousedown", (function () {
  _$jscoverage['plugins/undo.js'][253]++;
  me.undoManger.mousedown = true;
}));
});
