(function(){function ax(){}function aG(b){var a=aF.call(arguments,1);return function(){return b.apply(this,a)}}function aI(b,a){if(!a){throw new Error("prayer failed: "+b)}}function ah(A,b,k,B){function q(){var a;n=a8,a=g.selection?"$"+g.selection.latex()+"$":"",m.select(a)}var g,z,x,n,j,w,m,e=A.contents().detach();k||A.addClass("mathquill-rendered-math"),b.jQ=A.attr(a6,b.id),b.revert=function(){A.empty().unbind(".mathquill").removeClass("mathquill-rendered-math mathquill-editable mathquill-textbox").append(e)},g=b.cursor=aw(b),b.renderLatex(e.text()),z=b.textarea=aa('<span class="textarea"><textarea></textarea></span>'),x=z.children(),b.selectionChanged=function(){n===a8&&(n=setTimeout(q)),aL(A[0])},A.bind("selectstart.mathquill",function(a){a.target!==x[0]&&a.preventDefault(),a.stopPropagation()}),w=g.blink,A.bind("mousedown.mathquill",function(h){function c(f){return g.seek(aa(f.target),f.pageX,f.pageY),(g.prev!==j.prev||g.parent!==j.parent)&&g.selectFrom(j),!1}function a(f){return delete f.target,c(f)}function d(f){j=a8,g.blink=w,g.selection||(B?g.show():z.detach()),A.unbind("mousemove",c),aa(f.target.ownerDocument).unbind("mousemove",a).unbind("mouseup",d)}return setTimeout(function(){x.focus()}),g.blink=ax,g.seek(aa(h.target),h.pageX,h.pageY),j={parent:g.parent,prev:g.prev,next:g.next},B||A.prepend(z),A.mousemove(c),aa(h.target.ownerDocument).mousemove(a).mouseup(d),!1});if(!B){m=aX(x,{container:A}),A.bind("cut paste",!1).bind("copy",q).prepend('<span class="selectable">$'+b.latex()+"$</span>"),x.blur(function(){g.clearSelection(),setTimeout(y)});function y(){z.detach()}return}m=aX(x,{container:A,key:function(c,a){g.parent.bubble("onKey",c,a)},text:function(a){g.parent.bubble("onText",a)},cut:function(a){g.selection&&setTimeout(function(){g.prepareEdit(),g.parent.bubble("redraw")}),a.stopPropagation()},paste:function(a){a.slice(0,1)==="$"&&a.slice(-1)==="$"?a=a.slice(1,-1):a="\\text{"+a+"}",g.writeLatex(a).show()}}),A.prepend(z),A.addClass("mathquill-editable"),k&&A.addClass("mathquill-textbox"),x.focus(function(a){g.parent||g.appendTo(b),g.parent.jQ.addClass("hasCursor"),g.selection?(g.selection.jQ.removeClass("blur"),setTimeout(b.selectionChanged)):g.show(),a.stopPropagation()}).blur(function(a){g.hide().parent.blur(),g.selection&&g.selection.jQ.addClass("blur"),a.stopPropagation()}),A.bind("focus.mathquill blur.mathquill",function(a){x.trigger(a)}).blur()}function aE(b,c,a){return aQ(aC,{ctrlSeq:b,htmlTemplate:"<"+c+" "+a+">&0</"+c+">"})}var a8,aQ,aX,aS,a3,aR,aW,aP,bc,a7,aZ,ba,a4,aV,a9,aO,aY,a5,aL,bb,aN,az,ai,aM,ag,an,aB,a0,ap,aD,am,ao,bd,aA,al,av,aC,a2,ay,au,aT,aj,af,aK,ad,ac,ae,aJ,ar,aq,ak,aw,ab,aa=jQuery,aU="mathquill-command-id",a6="mathquill-block-id",a1=Math.min,aH=Math.max,aF=[].slice;aQ=function(f,b,g){function d(h){return typeof h=="object"}function a(h){return typeof h=="function"}function c(j,m){function i(o){var l=this;if(!(l instanceof i)){return new i(arguments)}o&&a(l.init)&&l.init.apply(l,o)}m===g&&(m=j,j=Object);var h=i[f]=new j,k=j[f],e,n=i.mixin=function(l){e={},a(l)?e=l.call(i,h,k,i,j):d(l)&&(e=l);if(d(e)){for(var o in e){b.call(e,o)&&(h[o]=e[o])}}return a(h.init)||(h.init=function(){j.apply(this,arguments)}),i};return h.constructor=i,n(m)}return c}("prototype",{}.hasOwnProperty),aX=function(){function b(g){var h=g.which||g.keyCode,f=a[h],c,d=[];return g.ctrlKey&&d.push("Ctrl"),g.originalEvent&&g.originalEvent.metaKey&&d.push("Meta"),g.altKey&&d.push("Alt"),g.shiftKey&&d.push("Shift"),c=f||String.fromCharCode(h),!d.length&&!f?c:(d.push(c),d.join("-"))}var a={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(C,I){function t(c){D=setTimeout(c),M=c}function G(){D&&(clearTimeout(D),D=a8,M())}function K(c){G(),N.val(c),c&&N[0].select()}function k(){var c=N[0];return"selectionStart" in c?c.selectionStart!==c.selectionEnd:!1}function O(d){var c=N.val();N.val(""),c&&d(c)}function q(){P(b(B),B)}function A(c){B=c,F=null,q()}function j(c){B&&F&&q(),F=c,t(function(){if(k()){return}O(z)})}function n(){B=F=null}function e(c){N.focus(),t(function(){O(L)})}var B=null,F=null;I||(I={});var z=I.text||ax,P=I.key||ax,L=I.paste||ax,H=I.cut||ax,N=aa(C),J=aa(I.container||N),D,M;return J.bind("keydown keypress input keyup focusout paste",G),J.bind({keydown:A,keypress:j,focusout:n,cut:H,paste:e}),{select:K}}}(),aS=aQ(function(A,G,k){function b(c,a){throw c?c="'"+c+"'":c="EOF","Parse Error: "+a+" at "+c}A.init=function(a){this._=a},A.parse=function(c){function a(f,d){return d}return this.skip(q)._(c,a,b)},A.or=function(c){aI("or is passed a parser",c instanceof k);var a=this;return k(function(h,f,d){function e(i){return c._(h,f,d)}return a._(h,f,e)})},A.then=function(c){var a=this;return k(function(f,d,e){function h(i,l){var m=c instanceof k?c:c(l);return aI("a parser is returned",m instanceof k),m._(i,d,e)}return a._(f,h,e)})},A.many=function(){var a=this;return k(function(d,l,f){function e(i,m){return d=i,c.push(m),!0}function h(){return !1}var c=[];while(a._(d,e,h)){}return l(d,c)})},A.times=function(d,a){arguments.length<2&&(a=d);var c=this;return k(function(m,r,L){function p(h,f){return e.push(f),m=h,!0}function I(h,f){return J=f,m=h,!1}function t(h,f){return !1}var e=[],K=!0,J;for(var v=0;v<d;v+=1){K=c._(m,p,I);if(!K){return L(m,J)}}for(;v<a&&K;v+=1){K=c._(m,p,t)}return r(m,e)})},A.result=function(a){return this.then(j(a))},A.atMost=function(a){return this.times(0,a)},A.atLeast=function(c){var a=this;return a.times(c).then(function(d){return a.many().map(function(e){return d.concat(e)})})},A.map=function(a){return this.then(function(c){return j(a(c))})},A.skip=function(a){return this.then(function(c){return a.result(c)})};var x=this.string=function(d){var a=d.length,c="expected '"+d+"'";return k(function(l,e,f){var h=l.slice(0,a);return h===d?e(l.slice(a),h):f(l,c)})},H=this.regex=function(c){aI("regexp parser is anchored",c.toString().charAt(1)==="^");var a="expected "+c;return k(function(l,f,d){var e=c.exec(l);if(e){var h=e[0];return f(l.slice(h.length),h)}return d(l,a)})},j=k.succeed=function(a){return k(function(c,d){return d(c,a)})},F=k.fail=function(a){return k(function(c,e,d){return d(c,a)})},D=k.letter=H(/^[a-z]/i),z=k.letters=H(/^[a-z]*/i),w=k.digit=H(/^[0-9]/),C=k.digits=H(/^[0-9]*/),y=k.whitespace=H(/^\s+/),g=k.optWhitespace=H(/^\s*/),B=k.any=k(function(c,a,d){return c?a(c.slice(1),c.charAt(0)):d(c,"expected any character")}),E=k.all=k(function(c,a,d){return a("",c)}),q=k.eof=k(function(c,a,d){return c?d(c,"expected EOF"):a(c,c)})}),a3=aQ(function(a){a.prev=0,a.next=0,a.parent=0,a.firstChild=0,a.lastChild=0,a.children=function(){return aR(this.firstChild,this.lastChild)},a.eachChild=function(b){return this.children().each(b)},a.foldChildren=function(c,b){return this.children().fold(c,b)},a.adopt=function(c,b,d){return aR(this,this).adopt(c,b,d),this},a.disown=function(){return aR(this,this).disown(),this}}),aR=aQ(function(b){function a(d,c,f){aI("a parent is always present",d),aI("prev is properly set up",function(){return c?c.next===f&&c.parent===d:d.firstChild===f}()),aI("next is properly set up",function(){return f?f.prev===c&&f.parent===d:d.lastChild===c}())}b.first=0,b.last=0,b.init=function(d,c){aI("no half-empty fragments",!d==!c);if(!d){return}aI("first node is passed to Fragment",d instanceof a3),aI("last node is passed to Fragment",c instanceof a3),aI("first and last have the same parent",d.parent===c.parent),this.first=d,this.last=c},b.adopt=function(g,j,f){a(g,j,f);var c=this;c.disowned=!1;var d=c.first;if(!d){return this}var h=c.last;return j||(g.firstChild=d),f?f.prev=h:g.lastChild=h,c.last.next=f,c.each(function(e){e.prev=j,e.parent=g,j&&(j.next=e),j=e}),c},b.disown=function(){var f=this,g=f.first;if(!g||f.disowned){return f}f.disowned=!0;var d=f.last,c=g.parent;return a(c,g.prev,g),a(c,d,d.next),g.prev?g.prev.next=d.next:c.firstChild=d.next,d.next?d.next.prev=g.prev:c.lastChild=g.prev,f},b.each=function(d){var c=this,f=c.first;if(!f){return c}for(;f!==c.last.next;f=f.next){if(d.call(c,f)===!1){break}}return c},b.fold=function(d,c){return this.each(function(e){d=c.call(this,d,e)}),d}}),aW=function(){var a=0;return function(){return a+=1}}(),aP=aQ(a3,function(a){a.init=function(b){this.id=aW(),aP[this.id]=this},a.toString=function(){return"[MathElement "+this.id+"]"},a.bubble=function(d){var b=aF.call(arguments,1);for(var f=this;f;f=f.parent){var c=f[d]&&f[d].apply(f,b);if(c===!1){break}}return this},a.postOrder=function(d){var b=aF.call(arguments,1);if(typeof d=="string"){var f=d;d=function(g){f in g&&g[f].apply(g,arguments)}}(function c(e){e.eachChild(c),d(e)})(this)},a.jQ=aa(),a.jQadd=function(b){this.jQ=this.jQ.add(b)},this.jQize=function(c){var b=aa(c);return b.find("*").andSelf().each(function(){var f=aa(this),d=f.attr("mathquill-command-id"),g=f.attr("mathquill-block-id");d&&aP[d].jQadd(f),g&&aP[g].jQadd(f)}),b},a.finalizeInsert=function(){var b=this;b.postOrder("finalizeTree"),b.postOrder("blur"),b.postOrder("respace"),b.next.respace&&b.next.respace(),b.prev.respace&&b.prev.respace(),b.postOrder("redraw"),b.bubble("redraw")}}),bc=aQ(aP,function(b,a){b.init=function(f,g,d){var c=this;a.init.call(c),c.ctrlSeq||(c.ctrlSeq=f),g&&(c.htmlTemplate=g),d&&(c.textTemplate=d)},b.replaces=function(c){c.disown(),this.replacedFragment=c},b.isEmpty=function(){return this.foldChildren(!0,function(d,c){return d&&c.isEmpty()})},b.parser=function(){var d=ak.block,c=this;return d.times(c.numBlocks()).map(function(f){c.blocks=f;for(var g=0;g<f.length;g+=1){f[g].adopt(c,c.lastChild,0)}return c})},b.createBefore=function(d){var c=this,f=c.replacedFragment;c.createBlocks(),aP.jQize(c.html()),f&&(f.adopt(c.firstChild,0,0),f.jQ.appendTo(c.firstChild.jQ)),d.jQ.before(c.jQ),d.prev=c.adopt(d.parent,d.prev,d.next),c.finalizeInsert(d),c.placeCursor(d)},b.createBlocks=function(){var g=this,d=g.numBlocks(),h=g.blocks=Array(d);for(var f=0;f<d;f+=1){var c=h[f]=aZ();c.adopt(g,g.lastChild,0)}},b.respace=ax,b.placeCursor=function(c){c.appendTo(this.foldChildren(this.firstChild,function(f,d){return f.isEmpty()?f:d}))},b.remove=function(){return this.disown(),this.jQ.remove(),this.postOrder(function(c){delete aP[c.id]}),this},b.numBlocks=function(){var c=this.htmlTemplate.match(/&\d+/g);return c?c.length:0},b.html=function(){var h=this,d=h.blocks,k=" mathquill-command-id="+h.id,g=h.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);aI("no unmatched angle brackets",g.join("")===this.htmlTemplate);for(var c=0,f=g[0];f;c+=1,f=g[c]){if(f.slice(-2)==="/>"){g[c]=f.slice(0,-2)+k+"/>"}else{if(f.charAt(0)==="<"){aI("not an unmatched top-level close tag",f.charAt(1)!=="/"),g[c]=f.slice(0,-1)+k+">";var j=1;do{c+=1,f=g[c],aI("no missing close tags",f),f.slice(0,2)==="</"?j-=1:f.charAt(0)==="<"&&f.slice(-2)!=="/>"&&(j+=1)}while(j>0)}}}return g.join("").replace(/>&(\d+)/g,function(i,l){return" mathquill-block-id="+d[l].id+">"+d[l].join("html")})},b.latex=function(){return this.foldChildren(this.ctrlSeq,function(d,c){return d+"{"+(c.latex()||" ")+"}"})},b.textTemplate=[""],b.text=function(){var c=0;return this.foldChildren(this.textTemplate[c],function(d,f){c+=1;var e=f.text();return d&&this.textTemplate[c]==="("&&e[0]==="("&&e.slice(-1)===")"?d+e.slice(1,-1)+this.textTemplate[c]:d+f.text()+(this.textTemplate[c]||"")})}}),a7=aQ(bc,function(b,a){b.init=function(d,f,c){c||(c=d&&d.length>1?d.slice(1):d),a.init.call(this,d,f,[c])},b.parser=function(){return aS.succeed(this)},b.numBlocks=function(){return 0},b.replaces=function(c){c.remove()},b.createBlocks=ax,b.latex=function(){return this.ctrlSeq},b.text=function(){return this.textTemplate},b.placeCursor=ax,b.isEmpty=function(){return !0}}),aZ=aQ(aP,function(a){a.join=function(b){return this.foldChildren("",function(c,d){return c+d[b]()})},a.latex=function(){return this.join("latex")},a.text=function(){return this.firstChild===this.lastChild?this.firstChild.text():"("+this.join("text")+")"},a.isEmpty=function(){return this.firstChild===0&&this.lastChild===0},a.focus=function(){return this.jQ.addClass("hasCursor"),this.jQ.removeClass("empty"),this},a.blur=function(){return this.jQ.removeClass("hasCursor"),this.isEmpty()&&this.jQ.addClass("empty"),this}}),ba=aQ(aR,function(b,a){b.init=function(c,d){a.init.call(this,c,d||c),this.jQ=this.fold(aa(),function(g,f){return f.jQ.add(g)})},b.latex=function(){return this.fold("",function(d,c){return d+c.latex()})},b.remove=function(){return this.jQ.remove(),this.each(function(c){c.postOrder(function(d){delete aP[d.id]})}),this.disown()}}),a4=aQ(aZ,function(b,a){b.latex=function(){return a.latex.call(this).replace(/(\\[a-z]+) (?![a-z])/ig,"$1")},b.text=function(){return this.foldChildren("",function(d,c){return d+c.text()})},b.renderLatex=function(d){var c=this.jQ;c.children().slice(1).remove(),this.firstChild=this.lastChild=0,this.cursor.appendTo(this).writeLatex(d)},b.onKey=function(d,c){switch(d){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":while(this.cursor.prev||this.cursor.selection){this.cursor.backspace()}break;case"Shift-Backspace":case"Backspace":this.cursor.backspace();break;case"Esc":case"Tab":case"Spacebar":var f=this.cursor.parent;if(f===this.cursor.root){d==="Spacebar"&&c.preventDefault();return}this.cursor.prepareMove(),f.next?this.cursor.prependTo(f.next):this.cursor.insertAfter(f.parent);break;case"Shift-Tab":case"Shift-Esc":case"Shift-Spacebar":var f=this.cursor.parent;if(f===this.cursor.root){d==="Shift-Spacebar"&&c.preventDefault();return}this.cursor.prepareMove(),f.prev?this.cursor.appendTo(f.prev):this.cursor.insertBefore(f.parent);break;case"Enter":break;case"End":this.cursor.prepareMove().appendTo(this.cursor.parent);break;case"Ctrl-End":this.cursor.prepareMove().appendTo(this);break;case"Shift-End":while(this.cursor.next){this.cursor.selectRight()}break;case"Ctrl-Shift-End":while(this.cursor.next||this.cursor.parent!==this){this.cursor.selectRight()}break;case"Home":this.cursor.prepareMove().prependTo(this.cursor.parent);break;case"Ctrl-Home":this.cursor.prepareMove().prependTo(this);break;case"Shift-Home":while(this.cursor.prev){this.cursor.selectLeft()}break;case"Ctrl-Shift-Home":while(this.cursor.prev||this.cursor.parent!==this){this.cursor.selectLeft()}break;case"Left":this.cursor.moveLeft();break;case"Shift-Left":this.cursor.selectLeft();break;case"Ctrl-Left":break;case"Right":this.cursor.moveRight();break;case"Shift-Right":this.cursor.selectRight();break;case"Ctrl-Right":break;case"Up":this.cursor.moveUp();break;case"Down":this.cursor.moveDown();break;case"Shift-Up":if(this.cursor.prev){while(this.cursor.prev){this.cursor.selectLeft()}}else{this.cursor.selectLeft()}case"Shift-Down":if(this.cursor.next){while(this.cursor.next){this.cursor.selectRight()}}else{this.cursor.selectRight()}case"Ctrl-Up":break;case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":while(this.cursor.next||this.cursor.selection){this.cursor.deleteForward()}break;case"Shift-Del":case"Del":this.cursor.deleteForward();break;case"Meta-A":case"Ctrl-A":if(this!==this.cursor.root){return}this.cursor.prepareMove().appendTo(this);while(this.cursor.prev){this.cursor.selectLeft()}break;default:return !1}return c.preventDefault(),!1},b.onText=function(c){return this.cursor.write(c),!1}}),aV=aQ(bc,function(b,a){b.init=function(c){a.init.call(this,"$"),this.cursor=c},b.htmlTemplate='<span class="mathquill-rendered-math">&0</span>',b.createBlocks=function(){this.firstChild=this.lastChild=a4(),this.blocks=[this.firstChild],this.firstChild.parent=this;var c=this.firstChild.cursor=this.cursor;this.firstChild.onText=function(d){return d!=="$"||c.parent!==this?c.write(d):this.isEmpty()?c.insertAfter(this.parent).backspace().insertNew(aK("\\$","$")).show():c.next?c.prev?c.write(d):c.insertBefore(this.parent):c.insertAfter(this.parent),!1}},b.latex=function(){return"$"+this.firstChild.latex()+"$"}}),a9=aQ(aZ,function(a){a.renderLatex=function(u){var A=this,g=A.cursor;A.jQ.children().slice(1).remove(),A.firstChild=A.lastChild=0,g.show().appendTo(A);var p=aS.regex,B=aS.string,b=aS.eof,y=aS.all,r=B("$").then(ak).skip(B("$").or(b)).map(function(f){var c=aV(g);c.createBlocks();var d=c.firstChild;return f.children().adopt(d,0,0),c}),k=B("\\$").result("$"),x=k.or(p(/^[^$]/)).map(aK),q=r.or(x).many(),w=q.skip(b).or(y.result(!1)).parse(u);if(w){for(var z=0;z<w.length;z+=1){w[z].adopt(A,A.lastChild,0)}var j=A.join("html");aP.jQize(j).appendTo(A.jQ),this.finalizeInsert()}},a.onKey=a4.prototype.onKey,a.onText=function(b){return this.cursor.prepareEdit(),b==="$"?this.cursor.insertNew(aV(this.cursor)):this.cursor.insertNew(aK(b)),!1}}),aO={},aY={},aL=ax,bb=document.createElement("div"),aN=bb.style,az={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(aM in az){if(aM in aN){ai=aM;break}}ai?a5=function(b,a,c){b.css(ai,"scale("+a+","+c+")")}:"filter" in aN?(aL=function(a){a.className=a.className},a5=function(f,b,g){function c(){f.css("marginRight",(d.width()-1)*(b-1)/b+"px")}var d,a;b/=1+(g-1)/2,f.css("fontSize",g+"em"),f.hasClass("matrixed-container")||f.addClass("matrixed-container").wrapInner('<span class="matrixed"></span>'),d=f.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+b+",SizingMethod='auto expand')"),c(),a=setInterval(c),aa(window).load(function(){clearTimeout(a),c()})}):a5=function(b,a,c){b.css("fontSize",c+"em")},ag=aQ(bc,function(b,a){b.init=function(d,f,c){a.init.call(this,d,"<"+f+" "+c+">&0</"+f+">")}}),aY.mathrm=aG(ag,"\\mathrm","span",'class="roman font"'),aY.mathit=aG(ag,"\\mathit","i",'class="font"'),aY.mathbf=aG(ag,"\\mathbf","b",'class="font"'),aY.mathsf=aG(ag,"\\mathsf","span",'class="sans-serif font"'),aY.mathtt=aG(ag,"\\mathtt","span",'class="monospace font"'),aY.underline=aG(ag,"\\underline","span",'class="non-leaf underline"'),aY.overline=aY.bar=aG(ag,"\\overline","span",'class="non-leaf overline"'),an=aQ(bc,function(b,a){b.init=function(d,f,c){a.init.call(this,d,"<"+f+' class="non-leaf">&0</'+f+">",[c])},b.finalizeTree=function(){function c(f){var d=this.parent,g=f;do{if(g.next){return f.insertBefore(d),!1}g=g.parent.parent}while(g!==d);return f.insertAfter(d),!1}aI("SupSub is only _ and ^",this.ctrlSeq==="^"||this.ctrlSeq==="_"),this.ctrlSeq==="_"?(this.down=this.firstChild,this.firstChild.up=c):(this.up=this.firstChild,this.firstChild.down=c)},b.latex=function(){var c=this.firstChild.latex();return c.length===1?this.ctrlSeq+c:this.ctrlSeq+"{"+(c||" ")+"}"},b.redraw=function(){this.prev&&this.prev.respace(),this.prev instanceof an||(this.respace(),this.next&&!(this.next instanceof an)&&this.next.respace())},b.respace=function(){this.prev.ctrlSeq==="\\int "||this.prev instanceof an&&this.prev.ctrlSeq!=this.ctrlSeq&&this.prev.prev&&this.prev.prev.ctrlSeq==="\\int "?this.limit||(this.limit=!0,this.jQ.addClass("limit")):this.limit&&(this.limit=!1,this.jQ.removeClass("limit")),this.respaced=this.prev instanceof an&&this.prev.ctrlSeq!=this.ctrlSeq&&!this.prev.respaced;if(this.respaced){var d=+this.jQ.css("fontSize").slice(0,-2),c=this.prev.jQ.outerWidth(),f=this.jQ.outerWidth();this.jQ.css({left:(this.limit&&this.ctrlSeq==="_"?-0.25:0)-c/d+"em",marginRight:0.1-a1(f,c)/d+"em"})}else{this.limit&&this.ctrlSeq==="_"?this.jQ.css({left:"-.25em",marginRight:""}):this.jQ.css({left:"",marginRight:""})}return this.next instanceof an&&this.next.respace(),this}}),aY.subscript=aY._=aG(an,"_","sub","_"),aY.superscript=aY.supscript=aY["^"]=aG(an,"^","sup","**"),aB=aY.frac=aY.dfrac=aY.cfrac=aY.fraction=aQ(bc,function(b,a){b.ctrlSeq="\\frac",b.htmlTemplate='<span class="fraction non-leaf"><span class="numerator">&0</span><span class="denominator">&1</span><span style="display:inline-block;width:0">&nbsp;</span></span>',b.textTemplate=["(","/",")"],b.finalizeTree=function(){this.up=this.lastChild.up=this.firstChild,this.down=this.firstChild.down=this.lastChild}}),a0=aY.over=aO["/"]=aQ(aB,function(b,a){b.createBefore=function(c){if(!this.replacedFragment){var d=c.prev;while(d&&!(d instanceof ae||d instanceof aC||d instanceof ar)){d=d.prev}d instanceof ar&&d.next instanceof an&&(d=d.next,d.next instanceof an&&d.next.ctrlSeq!=d.ctrlSeq&&(d=d.next)),d!==c.prev&&(this.replaces(ba(d.next||c.parent.firstChild,c.prev)),c.prev=d)}a.createBefore.call(this,c)}}),ap=aY.sqrt=aY["√"]=aQ(bc,function(b,a){b.ctrlSeq="\\sqrt",b.htmlTemplate='<span class="non-leaf"><span class="scaled sqrt-prefix">&radic;</span><span class="non-leaf sqrt-stem">&0</span></span>',b.textTemplate=["sqrt(",")"],b.parser=function(){return ak.optBlock.then(function(c){return ak.block.map(function(d){var e=aD();return e.blocks=[c,d],c.adopt(e,0,0),d.adopt(e,c,0),e})}).or(a.parser.call(this))},b.redraw=function(){var c=this.lastChild.jQ;a5(c.prev(),1,c.innerHeight()/+c.css("fontSize").slice(0,-2)-0.1)}}),aD=aY.nthroot=aQ(ap,function(b,a){b.htmlTemplate='<sup class="nthroot non-leaf">&0</sup><span class="scaled"><span class="sqrt-prefix scaled">&radic;</span><span class="sqrt-stem non-leaf">&1</span></span>',b.textTemplate=["sqrt[","](",")"],b.latex=function(){return"\\sqrt["+this.firstChild.latex()+"]{"+this.lastChild.latex()+"}"}}),am=aQ(bc,function(b,a){b.init=function(f,g,d,c){a.init.call(this,"\\left"+d,'<span class="non-leaf"><span class="scaled paren">'+f+'</span><span class="non-leaf">&0</span><span class="scaled paren">'+g+"</span></span>",[f,g]),this.end="\\right"+c},b.jQadd=function(){a.jQadd.apply(this,arguments);var c=this.jQ;this.bracketjQs=c.children(":first").add(c.children(":last"))},b.latex=function(){return this.ctrlSeq+this.firstChild.latex()+this.end},b.redraw=function(){var d=this.firstChild.jQ,c=d.outerHeight()/+d.css("fontSize").slice(0,-2);a5(this.bracketjQs,a1(1+0.2*(c-1),1.2),1.05*c)}}),aY.left=aQ(bc,function(a){a.parser=function(){var f,c,g,b=aS.regex,d=aS.string;return b=aS.regex,f=aS.succeed,c=ak.block,g=aS.optWhitespace,g.then(b(/^(?:[([|]|\\\{)/)).then(function(e){var h;return e.charAt(0)==="\\"&&(e=e.slice(1)),h=aO[e](),ak.map(function(i){h.blocks=[i],i.adopt(h,0,0)}).then(d("\\right")).skip(g).then(b(/^(?:[\])|]|\\\})/)).then(function(i){return i.slice(-1)!==h.end.slice(-1)?aS.fail("open doesn't match close"):f(h)})})}}),aY.right=aQ(bc,function(a){a.parser=function(){return aS.fail("unmatched \\right")}}),aY.lbrace=aO["{"]=aG(am,"{","}","\\{","\\}"),aY.langle=aY.lang=aG(am,"&lang;","&rang;","\\langle ","\\rangle "),ao=aQ(am,function(b,a){b.createBefore=function(c){!c.next&&c.parent.parent&&c.parent.parent.end===this.end&&!this.replacedFragment?c.insertAfter(c.parent.parent):a.createBefore.call(this,c)},b.placeCursor=function(c){this.firstChild.blur(),c.insertAfter(this)}}),aY.rbrace=aO["}"]=aG(ao,"{","}","\\{","\\}"),aY.rangle=aY.rang=aG(ao,"&lang;","&rang;","\\langle ","\\rangle "),bd=function(b,a){b.init=function(c,d){a.init.call(this,c,d,c,d)}},aA=aQ(am,bd),aY.lparen=aO["("]=aG(aA,"(",")"),aY.lbrack=aY.lbracket=aO["["]=aG(aA,"[","]"),al=aQ(ao,bd),aY.rparen=aO[")"]=aG(al,"(",")"),aY.rbrack=aY.rbracket=aO["]"]=aG(al,"[","]"),av=aY.lpipe=aY.rpipe=aO["|"]=aQ(aA,function(b,a){b.init=function(){a.init.call(this,"|","|")},b.createBefore=ao.prototype.createBefore}),aC=aO.$=aY.text=aY.textnormal=aY.textrm=aY.textup=aY.textmd=aQ(bc,function(b,a){b.ctrlSeq="\\text",b.htmlTemplate='<span class="text">&0</span>',b.replaces=function(c){c instanceof ba?this.replacedText=c.remove().jQ.text():typeof c=="string"&&(this.replacedText=c)},b.textTemplate=['"','"'],b.parser=function(){var d=aS.string,c=aS.regex,f=aS.optWhitespace;return f.then(d("{")).then(c(/^[^}]*/)).skip(d("}")).map(function(k){var h=aC();h.createBlocks();var l=h.firstChild;for(var j=0;j<k.length;j+=1){var g=aK(k.charAt(j));g.adopt(l,l.lastChild,0)}return h})},b.createBlocks=function(){this.firstChild=this.lastChild=a2(),this.blocks=[this.firstChild],this.firstChild.parent=this},b.finalizeInsert=function(){this.firstChild.blur=function(){return delete this.blur,this},a.finalizeInsert.call(this)},b.createBefore=function(c){a.createBefore.call(this,this.cursor=c);if(this.replacedText){for(var d=0;d<this.replacedText.length;d+=1){this.write(this.replacedText.charAt(d))}}},b.write=function(c){this.cursor.insertNew(aK(c))},b.onKey=function(d,c){if(!this.cursor.selection&&(d==="Backspace"&&!this.cursor.prev||d==="Del"&&!this.cursor.next)){return this.isEmpty()&&this.cursor.insertAfter(this),!1}},b.onText=function(d){this.cursor.prepareEdit();if(d!=="$"){this.write(d)}else{if(this.isEmpty()){this.cursor.insertAfter(this).backspace().insertNew(aK("\\$","$"))}else{if(!this.cursor.next){this.cursor.insertAfter(this)}else{if(!this.cursor.prev){this.cursor.insertBefore(this)}else{var c=aC(ba(this.cursor.next,this.firstChild.lastChild));c.placeCursor=function(f){this.prev=0,delete this.placeCursor,this.placeCursor(f)},c.firstChild.focus=function(){return this},this.cursor.insertAfter(this).insertNew(c),c.prev=this,this.cursor.insertBefore(c),delete c.firstChild.focus}}}}return !1}}),a2=aQ(aZ,function(b,a){b.blur=function(){this.jQ.removeClass("hasCursor");if(this.isEmpty()){var d=this.parent,c=d.cursor;c.parent===this?this.jQ.addClass("empty"):(c.hide(),d.remove(),c.next===d?c.next=d.next:c.prev===d&&(c.prev=d.prev),c.show().parent.bubble("redraw"))}return this},b.focus=function(){a.focus.call(this);var f=this.parent;if(f.next.ctrlSeq===f.ctrlSeq){var g=this,d=f.cursor,c=f.next.firstChild;c.eachChild(function(h){h.parent=g,h.jQ.appendTo(g.jQ)}),this.lastChild?this.lastChild.next=c.firstChild:this.firstChild=c.firstChild,c.firstChild.prev=this.lastChild,this.lastChild=c.lastChild,c.parent.remove(),d.prev?d.insertAfter(d.prev):d.prependTo(this),d.parent.bubble("redraw")}else{if(f.prev.ctrlSeq===f.ctrlSeq){var d=f.cursor;d.prev?f.prev.firstChild.focus():d.appendTo(f.prev.firstChild)}}return this}}),aY.em=aY.italic=aY.italics=aY.emph=aY.textit=aY.textsl=aE("\\textit","i",'class="text"'),aY.strong=aY.bold=aY.textbf=aE("\\textbf","b",'class="text"'),aY.sf=aY.textsf=aE("\\textsf","span",'class="sans-serif text"'),aY.tt=aY.texttt=aE("\\texttt","span",'class="monospace text"'),aY.textsc=aE("\\textsc","span",'style="font-variant:small-caps" class="text"'),aY.uppercase=aE("\\uppercase","span",'style="text-transform:uppercase" class="text"'),aY.lowercase=aE("\\lowercase","span",'style="text-transform:lowercase" class="text"'),ay=aO["\\"]=aQ(bc,function(b,a){b.ctrlSeq="\\",b.replaces=function(c){this._replacedFragment=c.disown(),this.isEmpty=function(){return !1}},b.htmlTemplate='<span class="latex-command-input non-leaf">\\<span>&0</span></span>',b.textTemplate=["\\"],b.createBlocks=function(){a.createBlocks.call(this),this.firstChild.focus=function(){return this.parent.jQ.addClass("hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("empty"),this},this.firstChild.blur=function(){return this.parent.jQ.removeClass("hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("empty"),this}},b.createBefore=function(c){a.createBefore.call(this,c),this.cursor=c.appendTo(this.firstChild);if(this._replacedFragment){var d=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("blur").bind("mousedown mousemove",function(f){return aa(f.target=d).trigger(f),!1}).insertBefore(this.jQ).add(this.jQ)}},b.latex=function(){return"\\"+this.firstChild.latex()+" "},b.onKey=function(d,c){if(d==="Tab"||d==="Enter"||d==="Spacebar"){return this.renderCommand(),c.preventDefault(),!1}},b.onText=function(c){if(c.match(/[a-z]/i)){return this.cursor.prepareEdit(),this.cursor.insertNew(aK(c)),!1}this.renderCommand();if(c==="\\"&&this.firstChild.isEmpty()){return !1}},b.renderCommand=function(){this.jQ=this.jQ.last(),this.remove(),this.next?this.cursor.insertBefore(this.next):this.cursor.appendTo(this.parent);var d=this.firstChild.latex(),c;d||(d="backslash"),this.cursor.insertCmd(d,this._replacedFragment)}}),au=aY.binom=aY.binomial=aQ(bc,function(b,a){b.ctrlSeq="\\binom",b.htmlTemplate='<span class="paren scaled">(</span><span class="non-leaf"><span class="array non-leaf"><span>&0</span><span>&1</span></span></span><span class="paren scaled">)</span>',b.textTemplate=["choose(",",",")"],b.redraw=function(){var d=this.jQ.eq(1),c=d.outerHeight()/+d.css("fontSize").slice(0,-2),f=this.jQ.filter(".paren");a5(f,a1(1+0.2*(c-1),1.2),1.05*c)}}),aT=aY.choose=aQ(au,function(a){a.createBefore=a0.prototype.createBefore}),aj=aY.vector=aQ(bc,function(b,a){b.ctrlSeq="\\vector",b.htmlTemplate='<span class="array"><span>&0</span></span>',b.latex=function(){return"\\begin{matrix}"+this.foldChildren([],function(d,c){return d.push(c.latex()),d}).join("\\\\")+"\\end{matrix}"},b.text=function(){return"["+this.foldChildren([],function(d,c){return d.push(c.text()),d}).join()+"]"},b.createBefore=function(c){a.createBefore.call(this,this.cursor=c)},b.onKey=function(f,c){var g=this.cursor.parent;if(g.parent===this){if(f==="Enter"){var d=aZ();return d.parent=this,d.jQ=aa("<span></span>").attr(a6,d.id).insertAfter(g.jQ),g.next?g.next.prev=d:this.lastChild=d,d.next=g.next,g.next=d,d.prev=g,this.bubble("redraw").cursor.appendTo(d),c.preventDefault(),!1}if(f==="Tab"&&!g.next){if(g.isEmpty()){if(g.prev){return this.cursor.insertAfter(this),delete g.prev.next,this.lastChild=g.prev,g.jQ.remove(),this.bubble("redraw"),c.preventDefault(),!1}return}var d=aZ();return d.parent=this,d.jQ=aa("<span></span>").attr(a6,d.id).appendTo(this.jQ),this.lastChild=d,g.next=d,d.prev=g,this.bubble("redraw").cursor.appendTo(d),c.preventDefault(),!1}if(c.which===8){if(g.isEmpty()){return g.prev?(this.cursor.appendTo(g.prev),g.prev.next=g.next):(this.cursor.insertBefore(this),this.firstChild=g.next),g.next?g.next.prev=g.prev:this.lastChild=g.prev,g.jQ.remove(),this.isEmpty()?this.cursor.deleteForward():this.bubble("redraw"),c.preventDefault(),!1}if(!this.cursor.prev){return c.preventDefault(),!1}}}}}),aY.editable=aQ(aV,function(b,a){b.init=function(){bc.prototype.init.call(this,"\\editable")},b.jQadd=function(){var d,f,c=this;a.jQadd.apply(c,arguments),d=c.firstChild.disown(),f=c.jQ.children().detach(),c.firstChild=c.lastChild=a4(),c.blocks=[c.firstChild],c.firstChild.parent=c,ah(c.jQ,c.firstChild,!1,!0),c.cursor=c.firstChild.cursor,d.children().adopt(c.firstChild,0,0),f.appendTo(c.firstChild.jQ),c.firstChild.cursor.appendTo(c.firstChild)},b.latex=function(){return this.firstChild.latex()},b.text=function(){return this.firstChild.text()}}),aY.f=aG(a7,"f",'<var class="florin">&fnof;</var><span style="display:inline-block;width:0">&nbsp;</span>'),af=aQ(a7,function(b,a){b.init=function(c,d){a.init.call(this,c,"<var>"+(d||c)+"</var>")},b.text=function(){var c=this.ctrlSeq;return this.prev&&!(this.prev instanceof af)&&!(this.prev instanceof ae)&&(c="*"+c),this.next&&!(this.next instanceof ae)&&this.next.ctrlSeq!=="^"&&(c+="*"),c}}),aK=aQ(a7,function(b,a){b.init=function(c,d){a.init.call(this,c,"<span>"+(d||c)+"</span>")}}),aO[" "]=aG(aK,"\\:"," "),aY.prime=aO["'"]=aG(aK,"'","&prime;"),ad=aQ(a7,function(b,a){b.init=function(c,d){a.init.call(this,c,'<span class="nonSymbola">'+(d||c)+"</span>")}}),aY["@"]=ad,aY["&"]=aG(ad,"\\&","&amp;"),aY["%"]=aG(ad,"\\%","%"),aY.alpha=aY.beta=aY.gamma=aY.delta=aY.zeta=aY.eta=aY.theta=aY.iota=aY.kappa=aY.mu=aY.nu=aY.xi=aY.rho=aY.sigma=aY.tau=aY.chi=aY.psi=aY.omega=aQ(af,function(b,a){b.init=function(c){a.init.call(this,"\\"+c+" ","&"+c+";")}}),aY.phi=aG(af,"\\phi ","&#981;"),aY.phiv=aY.varphi=aG(af,"\\varphi ","&phi;"),aY.epsilon=aG(af,"\\epsilon ","&#1013;"),aY.epsiv=aY.varepsilon=aG(af,"\\varepsilon ","&epsilon;"),aY.piv=aY.varpi=aG(af,"\\varpi ","&piv;"),aY.sigmaf=aY.sigmav=aY.varsigma=aG(af,"\\varsigma ","&sigmaf;"),aY.thetav=aY.vartheta=aY.thetasym=aG(af,"\\vartheta ","&thetasym;"),aY.upsilon=aY.upsi=aG(af,"\\upsilon ","&upsilon;"),aY.gammad=aY.Gammad=aY.digamma=aG(af,"\\digamma ","&#989;"),aY.kappav=aY.varkappa=aG(af,"\\varkappa ","&#1008;"),aY.rhov=aY.varrho=aG(af,"\\varrho ","&#1009;"),aY.pi=aY["π"]=aG(ad,"\\pi ","&pi;"),aY.lambda=aG(ad,"\\lambda ","&lambda;"),aY.Upsilon=aY.Upsi=aY.upsih=aY.Upsih=aG(a7,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),aY.Gamma=aY.Delta=aY.Theta=aY.Lambda=aY.Xi=aY.Pi=aY.Sigma=aY.Phi=aY.Psi=aY.Omega=aY.forall=aQ(aK,function(b,a){b.init=function(c){a.init.call(this,"\\"+c+" ","&"+c+";")}}),ac=aQ(bc,function(a){a.init=function(b){this.latex=b},a.createBefore=function(b){b.writeLatex(this.latex)},a.parser=function(){var b=ak.parse(this.latex).children();return aS.succeed(b)}}),aY["¹"]=aG(ac,"^1"),aY["²"]=aG(ac,"^2"),aY["³"]=aG(ac,"^3"),aY["¼"]=aG(ac,"\\frac14"),aY["½"]=aG(ac,"\\frac12"),aY["¾"]=aG(ac,"\\frac34"),ae=aQ(a7,function(b,a){b.init=function(d,f,c){a.init.call(this,d,'<span class="binary-operator">'+f+"</span>",c)}}),aJ=aQ(ae,function(a){a.init=aK.prototype.init,a.respace=function(){return this.prev?this.prev instanceof ae&&this.next&&!(this.next instanceof ae)?this.jQ[0].className="unary-operator":this.jQ[0].className="binary-operator":this.jQ[0].className="",this}}),aY["+"]=aG(aJ,"+","+"),aY["–"]=aY["-"]=aG(aJ,"-","&minus;"),aY["±"]=aY.pm=aY.plusmn=aY.plusminus=aG(aJ,"\\pm ","&plusmn;"),aY.mp=aY.mnplus=aY.minusplus=aG(aJ,"\\mp ","&#8723;"),aO["*"]=aY.sdot=aY.cdot=aG(ae,"\\cdot ","&middot;"),aY["="]=aG(ae,"=","="),aY["<"]=aG(ae,"<","&lt;"),aY[">"]=aG(ae,">","&gt;"),aY.notin=aY.sim=aY.cong=aY.equiv=aY.oplus=aY.otimes=aQ(ae,function(b,a){b.init=function(c){a.init.call(this,"\\"+c+" ","&"+c+";")}}),aY.times=aG(ae,"\\times ","&times;","[x]"),aY["÷"]=aY.div=aY.divide=aY.divides=aG(ae,"\\div ","&divide;","[/]"),aY["≠"]=aY.ne=aY.neq=aG(ae,"\\ne ","&ne;"),aY.ast=aY.star=aY.loast=aY.lowast=aG(ae,"\\ast ","&lowast;"),aY.therefor=aY.therefore=aG(ae,"\\therefore ","&there4;"),aY.cuz=aY.because=aG(ae,"\\because ","&#8757;"),aY.prop=aY.propto=aG(ae,"\\propto ","&prop;"),aY["≈"]=aY.asymp=aY.approx=aG(ae,"\\approx ","&asymp;"),aY.lt=aG(ae,"<","&lt;"),aY.gt=aG(ae,">","&gt;"),aY["≤"]=aY.le=aY.leq=aG(ae,"\\le ","&le;"),aY["≥"]=aY.ge=aY.geq=aG(ae,"\\ge ","&ge;"),aY.isin=aY["in"]=aG(ae,"\\in ","&isin;"),aY.ni=aY.contains=aG(ae,"\\ni ","&ni;"),aY.notni=aY.niton=aY.notcontains=aY.doesnotcontain=aG(ae,"\\not\\ni ","&#8716;"),aY.sub=aY.subset=aG(ae,"\\subset ","&sub;"),aY.sup=aY.supset=aY.superset=aG(ae,"\\supset ","&sup;"),aY.nsub=aY.notsub=aY.nsubset=aY.notsubset=aG(ae,"\\not\\subset ","&#8836;"),aY.nsup=aY.notsup=aY.nsupset=aY.notsupset=aY.nsuperset=aY.notsuperset=aG(ae,"\\not\\supset ","&#8837;"),aY.sube=aY.subeq=aY.subsete=aY.subseteq=aG(ae,"\\subseteq ","&sube;"),aY.supe=aY.supeq=aY.supsete=aY.supseteq=aY.supersete=aY.superseteq=aG(ae,"\\supseteq ","&supe;"),aY.nsube=aY.nsubeq=aY.notsube=aY.notsubeq=aY.nsubsete=aY.nsubseteq=aY.notsubsete=aY.notsubseteq=aG(ae,"\\not\\subseteq ","&#8840;"),aY.nsupe=aY.nsupeq=aY.notsupe=aY.notsupeq=aY.nsupsete=aY.nsupseteq=aY.notsupsete=aY.notsupseteq=aY.nsupersete=aY.nsuperseteq=aY.notsupersete=aY.notsuperseteq=aG(ae,"\\not\\supseteq ","&#8841;"),ar=aQ(a7,function(b,a){b.init=function(c,d){a.init.call(this,c,"<big>"+d+"</big>")}}),aY["∑"]=aY.sum=aY.summation=aG(ar,"\\sum ","&sum;"),aY["∏"]=aY.prod=aY.product=aG(ar,"\\prod ","&prod;"),aY.coprod=aY.coproduct=aG(ar,"\\coprod ","&#8720;"),aY["∫"]=aY["int"]=aY.integral=aG(ar,"\\int ","&int;"),aY.N=aY.naturals=aY.Naturals=aG(aK,"\\mathbb{N}","&#8469;"),aY.P=aY.primes=aY.Primes=aY.projective=aY.Projective=aY.probability=aY.Probability=aG(aK,"\\mathbb{P}","&#8473;"),aY.Z=aY.integers=aY.Integers=aG(aK,"\\mathbb{Z}","&#8484;"),aY.Q=aY.rationals=aY.Rationals=aG(aK,"\\mathbb{Q}","&#8474;"),aY.R=aY.reals=aY.Reals=aG(aK,"\\mathbb{R}","&#8477;"),aY.C=aY.complex=aY.Complex=aY.complexes=aY.Complexes=aY.complexplane=aY.Complexplane=aY.ComplexPlane=aG(aK,"\\mathbb{C}","&#8450;"),aY.H=aY.Hamiltonian=aY.quaternions=aY.Quaternions=aG(aK,"\\mathbb{H}","&#8461;"),aY.quad=aY.emsp=aG(aK,"\\quad ","    "),aY.qquad=aG(aK,"\\qquad ","        "),aY.diamond=aG(aK,"\\diamond ","&#9671;"),aY.bigtriangleup=aG(aK,"\\bigtriangleup ","&#9651;"),aY.ominus=aG(aK,"\\ominus ","&#8854;"),aY.uplus=aG(aK,"\\uplus ","&#8846;"),aY.bigtriangledown=aG(aK,"\\bigtriangledown ","&#9661;"),aY.sqcap=aG(aK,"\\sqcap ","&#8851;"),aY.triangleleft=aG(aK,"\\triangleleft ","&#8882;"),aY.sqcup=aG(aK,"\\sqcup ","&#8852;"),aY.triangleright=aG(aK,"\\triangleright ","&#8883;"),aY.odot=aG(aK,"\\odot ","&#8857;"),aY.bigcirc=aG(aK,"\\bigcirc ","&#9711;"),aY.dagger=aG(aK,"\\dagger ","&#0134;"),aY.ddagger=aG(aK,"\\ddagger ","&#135;"),aY.wr=aG(aK,"\\wr ","&#8768;"),aY.amalg=aG(aK,"\\amalg ","&#8720;"),aY.models=aG(aK,"\\models ","&#8872;"),aY.prec=aG(aK,"\\prec ","&#8826;"),aY.succ=aG(aK,"\\succ ","&#8827;"),aY.preceq=aG(aK,"\\preceq ","&#8828;"),aY.succeq=aG(aK,"\\succeq ","&#8829;"),aY.simeq=aG(aK,"\\simeq ","&#8771;"),aY.mid=aG(aK,"\\mid ","&#8739;"),aY.ll=aG(aK,"\\ll ","&#8810;"),aY.gg=aG(aK,"\\gg ","&#8811;"),aY.parallel=aG(aK,"\\parallel ","&#8741;"),aY.bowtie=aG(aK,"\\bowtie ","&#8904;"),aY.sqsubset=aG(aK,"\\sqsubset ","&#8847;"),aY.sqsupset=aG(aK,"\\sqsupset ","&#8848;"),aY.smile=aG(aK,"\\smile ","&#8995;"),aY.sqsubseteq=aG(aK,"\\sqsubseteq ","&#8849;"),aY.sqsupseteq=aG(aK,"\\sqsupseteq ","&#8850;"),aY.doteq=aG(aK,"\\doteq ","&#8784;"),aY.frown=aG(aK,"\\frown ","&#8994;"),aY.vdash=aG(aK,"\\vdash ","&#8870;"),aY.dashv=aG(aK,"\\dashv ","&#8867;"),aY.longleftarrow=aG(aK,"\\longleftarrow ","&#8592;"),aY.longrightarrow=aG(aK,"\\longrightarrow ","&#8594;"),aY.Longleftarrow=aG(aK,"\\Longleftarrow ","&#8656;"),aY.Longrightarrow=aG(aK,"\\Longrightarrow ","&#8658;"),aY.longleftrightarrow=aG(aK,"\\longleftrightarrow ","&#8596;"),aY.updownarrow=aG(aK,"\\updownarrow ","&#8597;"),aY.Longleftrightarrow=aG(aK,"\\Longleftrightarrow ","&#8660;"),aY.Updownarrow=aG(aK,"\\Updownarrow ","&#8661;"),aY.mapsto=aG(aK,"\\mapsto ","&#8614;"),aY.nearrow=aG(aK,"\\nearrow ","&#8599;"),aY.hookleftarrow=aG(aK,"\\hookleftarrow ","&#8617;"),aY.hookrightarrow=aG(aK,"\\hookrightarrow ","&#8618;"),aY.searrow=aG(aK,"\\searrow ","&#8600;"),aY.leftharpoonup=aG(aK,"\\leftharpoonup ","&#8636;"),aY.rightharpoonup=aG(aK,"\\rightharpoonup ","&#8640;"),aY.swarrow=aG(aK,"\\swarrow ","&#8601;"),aY.leftharpoondown=aG(aK,"\\leftharpoondown ","&#8637;"),aY.rightharpoondown=aG(aK,"\\rightharpoondown ","&#8641;"),aY.nwarrow=aG(aK,"\\nwarrow ","&#8598;"),aY.ldots=aG(aK,"\\ldots ","&#8230;"),aY.cdots=aG(aK,"\\cdots ","&#8943;"),aY.vdots=aG(aK,"\\vdots ","&#8942;"),aY.ddots=aG(aK,"\\ddots ","&#8944;"),aY.surd=aG(aK,"\\surd ","&#8730;"),aY.triangle=aG(aK,"\\triangle ","&#9653;"),aY.ell=aG(aK,"\\ell ","&#8467;"),aY.top=aG(aK,"\\top ","&#8868;"),aY.flat=aG(aK,"\\flat ","&#9837;"),aY.natural=aG(aK,"\\natural ","&#9838;"),aY.sharp=aG(aK,"\\sharp ","&#9839;"),aY.wp=aG(aK,"\\wp ","&#8472;"),aY.bot=aG(aK,"\\bot ","&#8869;"),aY.clubsuit=aG(aK,"\\clubsuit ","&#9827;"),aY.diamondsuit=aG(aK,"\\diamondsuit ","&#9826;"),aY.heartsuit=aG(aK,"\\heartsuit ","&#9825;"),aY.spadesuit=aG(aK,"\\spadesuit ","&#9824;"),aY.oint=aG(aK,"\\oint ","&#8750;"),aY.bigcap=aG(aK,"\\bigcap ","&#8745;"),aY.bigcup=aG(aK,"\\bigcup ","&#8746;"),aY.bigsqcup=aG(aK,"\\bigsqcup ","&#8852;"),aY.bigvee=aG(aK,"\\bigvee ","&#8744;"),aY.bigwedge=aG(aK,"\\bigwedge ","&#8743;"),aY.bigodot=aG(aK,"\\bigodot ","&#8857;"),aY.bigotimes=aG(aK,"\\bigotimes ","&#8855;"),aY.bigoplus=aG(aK,"\\bigoplus ","&#8853;"),aY.biguplus=aG(aK,"\\biguplus ","&#8846;"),aY.lfloor=aG(aK,"\\lfloor ","&#8970;"),aY.rfloor=aG(aK,"\\rfloor ","&#8971;"),aY.lceil=aG(aK,"\\lceil ","&#8968;"),aY.rceil=aG(aK,"\\rceil ","&#8969;"),aY.slash=aG(aK,"\\slash ","&#47;"),aY.opencurlybrace=aG(aK,"\\opencurlybrace ","&#123;"),aY.closecurlybrace=aG(aK,"\\closecurlybrace ","&#125;"),aY.caret=aG(aK,"\\caret ","^"),aY.underscore=aG(aK,"\\underscore ","_"),aY.backslash=aG(aK,"\\backslash ","\\"),aY.vert=aG(aK,"|"),aY.perp=aY.perpendicular=aG(aK,"\\perp ","&perp;"),aY.nabla=aY.del=aG(aK,"\\nabla ","&nabla;"),aY.hbar=aG(aK,"\\hbar ","&#8463;"),aY.AA=aY.Angstrom=aY.angstrom=aG(aK,"\\text\\AA ","&#8491;"),aY.ring=aY.circ=aY.circle=aG(aK,"\\circ ","&#8728;"),aY.bull=aY.bullet=aG(aK,"\\bullet ","&bull;"),aY.setminus=aY.smallsetminus=aG(aK,"\\setminus ","&#8726;"),aY.not=aY["¬"]=aY.neg=aG(aK,"\\neg ","&not;"),aY["…"]=aY.dots=aY.ellip=aY.hellip=aY.ellipsis=aY.hellipsis=aG(aK,"\\dots ","&hellip;"),aY.converges=aY.darr=aY.dnarr=aY.dnarrow=aY.downarrow=aG(aK,"\\downarrow ","&darr;"),aY.dArr=aY.dnArr=aY.dnArrow=aY.Downarrow=aG(aK,"\\Downarrow ","&dArr;"),aY.diverges=aY.uarr=aY.uparrow=aG(aK,"\\uparrow ","&uarr;"),aY.uArr=aY.Uparrow=aG(aK,"\\Uparrow ","&uArr;"),aY.to=aG(ae,"\\to ","&rarr;"),aY.rarr=aY.rightarrow=aG(aK,"\\rightarrow ","&rarr;"),aY.implies=aG(ae,"\\Rightarrow ","&rArr;"),aY.rArr=aY.Rightarrow=aG(aK,"\\Rightarrow ","&rArr;"),aY.gets=aG(ae,"\\gets ","&larr;"),aY.larr=aY.leftarrow=aG(aK,"\\leftarrow ","&larr;"),aY.impliedby=aG(ae,"\\Leftarrow ","&lArr;"),aY.lArr=aY.Leftarrow=aG(aK,"\\Leftarrow ","&lArr;"),aY.harr=aY.lrarr=aY.leftrightarrow=aG(aK,"\\leftrightarrow ","&harr;"),aY.iff=aG(ae,"\\Leftrightarrow ","&hArr;"),aY.hArr=aY.lrArr=aY.Leftrightarrow=aG(aK,"\\Leftrightarrow ","&hArr;"),aY.Re=aY.Real=aY.real=aG(aK,"\\Re ","&real;"),aY.Im=aY.imag=aY.image=aY.imagin=aY.imaginary=aY.Imaginary=aG(aK,"\\Im ","&image;"),aY.part=aY.partial=aG(aK,"\\partial ","&part;"),aY.inf=aY.infin=aY.infty=aY.infinity=aG(aK,"\\infty ","&infin;"),aY.alef=aY.alefsym=aY.aleph=aY.alephsym=aG(aK,"\\aleph ","&alefsym;"),aY.xist=aY.xists=aY.exist=aY.exists=aG(aK,"\\exists ","&exist;"),aY.and=aY.land=aY.wedge=aG(aK,"\\wedge ","&and;"),aY.or=aY.lor=aY.vee=aG(aK,"\\vee ","&or;"),aY.o=aY.O=aY.empty=aY.emptyset=aY.oslash=aY.Oslash=aY.nothing=aY.varnothing=aG(ae,"\\varnothing ","&empty;"),aY.cup=aY.union=aG(ae,"\\cup ","&cup;"),aY.cap=aY.intersect=aY.intersection=aG(ae,"\\cap ","&cap;"),aY.deg=aY.degree=aG(aK,"^\\circ ","&deg;"),aY.ang=aY.angle=aG(aK,"\\angle ","&ang;"),aq=aQ(a7,function(b,a){b.init=function(c){a.init.call(this,"\\"+c+" ","<span>"+c+"</span>")},b.respace=function(){this.jQ[0].className=this.next instanceof an||this.next instanceof am?"":"non-italicized-function"}}),aY.ln=aY.lg=aY.log=aY.span=aY.proj=aY.det=aY.dim=aY.min=aY.max=aY.mod=aY.lcm=aY.gcd=aY.gcf=aY.hcf=aY.lim=aq,function(){var b,a=["sin","cos","tan","sec","cosec","csc","cotan","cot"];for(b in a){aY[a[b]]=aY[a[b]+"h"]=aY["a"+a[b]]=aY["arc"+a[b]]=aY["a"+a[b]+"h"]=aY["arc"+a[b]+"h"]=aq}}(),ak=function(){function F(b){var a=aZ();return b.adopt(a,0,0),a}function q(b){var a=b[0]||aZ();for(var c=1;c<b.length;c+=1){b[c].children().adopt(a,a.lastChild,0)}return a}var A=aS.string,B=aS.regex,r=aS.letter,z=aS.any,m=aS.optWhitespace,J=aS.succeed,E=aS.fail,H=r.map(af),C=B(/^[^${}\\_^]/).map(aK),x=B(/^[^\\]/).or(A("\\").then(B(/^[a-z]+/i).or(B(/^\s+/).result(" ")).or(z))).then(function(b){var a=aY[b];return a?a(b).parser():E("unknown command: \\"+b)}),G=x.or(H).or(C),l=A("{").then(function(){return j}).skip(A("}")),D=m.then(l.or(G.map(F))),j=D.many().map(q).skip(m),I=A("[").then(D.then(function(a){return a.join("latex")!=="]"?J(a):E()}).many().map(q).skip(m)).skip(A("]")),k=j;return k.block=D,k.optBlock=I,k}(),aw=aQ(function(c){function b(k,g){if(k.next[g]){k.prependTo(k.next[g])}else{if(k.prev[g]){k.appendTo(k.prev[g])}else{var j=k.parent;do{var f=j[g];if(f){typeof f=="function"&&(f=j[g](k));if(f===!1||f instanceof aZ){k.upDownCache[j.id]={parent:k.parent,prev:k.prev,next:k.next};if(f instanceof aZ){var h=k.upDownCache[f.id];if(h){h.next?k.insertBefore(h.next):k.appendTo(h.parent)}else{var l=d(k).left;k.appendTo(f),k.seekHoriz(l,f)}}break}}j=j.parent.parent}while(j)}}return k.clearSelection().show()}function d(g){var f=g.jQ.removeClass("cursor").offset();return g.jQ.addClass("cursor"),f}function a(f){f.upDownCache={}}c.init=function(g){this.parent=this.root=g;var f=this.jQ=this._jQ=aa('<span class="cursor">&zwj;</span>');this.blink=function(){f.toggleClass("blink")},this.upDownCache={}},c.prev=0,c.next=0,c.parent=0,c.show=function(){return this.jQ=this._jQ.removeClass("blink"),"intervalId" in this?clearInterval(this.intervalId):(this.next?this.selection&&this.selection.first.prev===this.prev?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this.next.jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},c.hide=function(){return"intervalId" in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=aa(),this},c.insertAt=function(h,f,i){try{var g=this.parent;this.parent=h,this.prev=f,this.next=i,g.blur()}catch(h){}},c.insertBefore=function(f){return this.insertAt(f.parent,f.prev,f),this.parent.jQ.addClass("hasCursor"),this.jQ.insertBefore(f.jQ.first()),this},c.insertAfter=function(f){return this.insertAt(f.parent,f,f.next),this.parent.jQ.addClass("hasCursor"),this.jQ.insertAfter(f.jQ.last()),this},c.prependTo=function(f){return this.insertAt(f,0,f.firstChild),f.textarea?this.jQ.insertAfter(f.textarea):this.jQ.prependTo(f.jQ),f.focus(),this},c.appendTo=function(f){return this.insertAt(f,f.lastChild,0),this.jQ.appendTo(f.jQ),f.focus(),this},c.hopLeft=function(){return this.jQ.insertBefore(this.prev.jQ.first()),this.next=this.prev,this.prev=this.prev.prev,this},c.hopRight=function(){return this.jQ.insertAfter(this.next.jQ.last()),this.prev=this.next,this.next=this.next.next,this},c.moveLeftWithin=function(f){if(this.prev){this.prev.lastChild?this.appendTo(this.prev.lastChild):this.hopLeft()}else{if(this.parent===f){return}this.parent.prev?this.appendTo(this.parent.prev):this.insertBefore(this.parent.parent)}},c.moveRightWithin=function(f){if(this.next){this.next.firstChild?this.prependTo(this.next.firstChild):this.hopRight()}else{if(this.parent===f){return}this.parent.next?this.prependTo(this.parent.next):this.insertAfter(this.parent.parent)}},c.moveLeft=function(){return a(this),this.selection?this.insertBefore(this.selection.first).clearSelection():this.moveLeftWithin(this.root),this.show()},c.moveRight=function(){return a(this),this.selection?this.insertAfter(this.selection.last).clearSelection():this.moveRightWithin(this.root),this.show()},c.moveUp=function(){return b(this,"up")},c.moveDown=function(){return b(this,"down")},c.seek=function(i,f,k){a(this);var h,g,j=this.clearSelection().show();return i.hasClass("empty")?(j.prependTo(aP[i.attr(a6)]),j):(h=aP[i.attr(aU)],h instanceof a7?(i.outerWidth()>2*(f-i.offset().left)?j.insertBefore(h):j.insertAfter(h),j):(h||(g=aP[i.attr(a6)],g||(i=i.parent(),h=aP[i.attr(aU)],h||(g=aP[i.attr(a6)],g||(g=j.root)))),h?j.insertAfter(h):j.appendTo(g),j.seekHoriz(f,j.root)))},c.seekHoriz=function(k,g){var j=this,f=d(j).left-k,h;do{j.moveLeftWithin(g),h=f,f=d(j).left-k}while(f>0&&(j.prev||j.parent!==g));return -f>h&&j.moveRightWithin(g),j},c.writeLatex=function(h){var f=this;a(f),f.show().deleteSelection();var j=aS.all,g=aS.eof,i=ak.skip(g).or(j.result(!1)).parse(h);return i&&(i.children().adopt(f.parent,f.prev,f.next),aP.jQize(i.join("html")).insertBefore(f.jQ),f.prev=i.lastChild,i.finalizeInsert(),f.parent.bubble("redraw")),this.hide()},c.write=function(f){return a(this),this.show().insertCh(f)},c.insertCh=function(g){var f;return g.match(/^[a-eg-zA-Z]$/)?f=af(g):(f=aO[g]||aY[g])?f=f(g):f=aK(g),this.selection&&(this.prev=this.selection.first.prev,this.next=this.selection.last.next,f.replaces(this.selection),delete this.selection),this.insertNew(f)},c.insertNew=function(f){return f.createBefore(this),this},c.insertCmd=function(g,f){var h=aY[g];return h?(h=h(g),f&&h.replaces(f),this.insertNew(h)):(h=aC(),h.replaces(g),h.firstChild.focus=function(){return delete this.focus,this},this.insertNew(h).insertAfter(h),f&&f.remove()),this},c.unwrapGramp=function(){var j=this.parent.parent,g=j.parent,k=j.next,h=this,f=j.prev;j.disown().eachChild(function(e){if(e.isEmpty()){return}e.children().adopt(g,f,k).each(function(i){i.jQ.insertBefore(j.jQ.first())}),f=e.lastChild});if(!this.next){if(this.prev){this.next=this.prev.next}else{while(!this.next){this.parent=this.parent.next;if(!this.parent){this.next=j.next,this.parent=g;break}this.next=this.parent.firstChild}}}this.next?this.insertBefore(this.next):this.appendTo(g),j.jQ.remove(),j.prev&&j.prev.respace(),j.next&&j.next.respace()},c.backspace=function(){a(this),this.show();if(!this.deleteSelection()){if(this.prev){this.prev.isEmpty()?this.prev=this.prev.remove().prev:this.selectLeft()}else{if(this.parent!==this.root){if(this.parent.parent.isEmpty()){return this.insertAfter(this.parent.parent).backspace()}this.unwrapGramp()}}}return this.prev&&this.prev.respace(),this.next&&this.next.respace(),this.parent.bubble("redraw"),this},c.deleteForward=function(){a(this),this.show();if(!this.deleteSelection()){if(this.next){this.next.isEmpty()?this.next=this.next.remove().next:this.selectRight()}else{if(this.parent!==this.root){if(this.parent.parent.isEmpty()){return this.insertBefore(this.parent.parent).deleteForward()}this.unwrapGramp()}}}return this.prev&&this.prev.respace(),this.next&&this.next.respace(),this.parent.bubble("redraw"),this},c.selectFrom=function(k){var p=this,h=k;k:for(;;){for(var f=this;f!==p.parent.parent;f=f.parent.parent){if(f.parent===h.parent){q=f,g=h;break k}}for(var j=k;j!==h.parent.parent;j=j.parent.parent){if(p.parent===j.parent){q=p,g=j;break k}}p.parent.parent&&(p=p.parent.parent),h.parent.parent&&(h=h.parent.parent)}var q,g,m;if(q.next!==g){for(var l=q;l;l=l.next){if(l===g.prev){m=!0;break}}m||(m=g,g=q,q=m)}this.hide().selection=ab(q.prev.next||q.parent.firstChild,g.next.prev||g.parent.lastChild),this.insertAfter(g.next.prev||g.parent.lastChild),this.root.selectionChanged()},c.selectLeft=function(){a(this);if(this.selection){if(this.selection.first===this.next){this.prev?this.hopLeft().selection.extendLeft():this.parent!==this.root&&this.insertBefore(this.parent.parent).selection.levelUp()}else{this.hopLeft();if(this.selection.first===this.selection.last){this.clearSelection().show();return}this.selection.retractLeft()}}else{if(this.prev){this.hopLeft()}else{if(this.parent===this.root){return}this.insertBefore(this.parent.parent)}this.hide().selection=ab(this.next)}this.root.selectionChanged()},c.selectRight=function(){a(this);if(this.selection){if(this.selection.last===this.prev){this.next?this.hopRight().selection.extendRight():this.parent!==this.root&&this.insertAfter(this.parent.parent).selection.levelUp()}else{this.hopRight();if(this.selection.first===this.selection.last){this.clearSelection().show();return}this.selection.retractRight()}}else{if(this.next){this.hopRight()}else{if(this.parent===this.root){return}this.insertAfter(this.parent.parent)}this.hide().selection=ab(this.prev)}this.root.selectionChanged()},c.prepareMove=function(){return a(this),this.show().clearSelection()},c.prepareEdit=function(){return a(this),this.show().deleteSelection()},c.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.root.selectionChanged()),this},c.deleteSelection=function(){return this.selection?(this.prev=this.selection.first.prev,this.next=this.selection.last.next,this.selection.remove(),this.root.selectionChanged(),delete this.selection):!1}}),ab=aQ(ba,function(b,a){b.init=function(){var c=this;a.init.apply(c,arguments),c.jQwrap(c.jQ)},b.jQwrap=function(c){this.jQ=c.wrapAll('<span class="selection"></span>').parent()},b.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),a.adopt.apply(this,arguments)},b.clear=function(){return this.jQ.replaceWith(this.jQ.children()),this},b.levelUp=function(){var d=this,c=d.first=d.last=d.last.parent.parent;return d.clear().jQwrap(c.jQ),d},b.extendLeft=function(){this.first=this.first.prev,this.first.jQ.prependTo(this.jQ)},b.extendRight=function(){this.last=this.last.next,this.last.jQ.appendTo(this.jQ)},b.retractRight=function(){this.first.jQ.insertBefore(this.jQ),this.first=this.first.next},b.retractLeft=function(){this.last.jQ.insertAfter(this.jQ),this.last=this.last.prev}}),aa.fn.mathquill=function(f,b){var h,d,a,c,g;switch(f){case"redraw":return this.each(function(){var j=aa(this).attr(a6),i=j&&aP[j];i&&function k(l){l.eachChild(k),l.redraw&&l.redraw()}(i)});case"revert":return this.each(function(){var j=aa(this).attr(a6),i=j&&aP[j];i&&i.revert&&i.revert()});case"latex":if(arguments.length>1){return this.each(function(){var i=aa(this).attr(a6),j=i&&aP[i];j&&j.renderLatex(b)})}return h=aa(this).attr(a6),d=h&&aP[h],d&&d.latex();case"text":return h=aa(this).attr(a6),d=h&&aP[h],d&&d.text();case"html":return this.html().replace(/ ?hasCursor|hasCursor /,"").replace(/ class=(""|(?= |>))/g,"").replace(/<span class="?cursor( blink)?"?><\/span>/i,"").replace(/<span class="?textarea"?><textarea><\/textarea><\/span>/i,"");case"write":if(arguments.length>1){return this.each(function(){var j=aa(this).attr(a6),k=j&&aP[j],i=k&&k.cursor;i&&i.writeLatex(b).parent.blur()})}case"cmd":if(arguments.length>1){return this.each(function(){var l,m=aa(this).attr(a6),k=m&&aP[m],j=k&&k.cursor;j&&(j.show(),/^\\[a-z]+$/i.test(b)?(l=j.selection,l&&(j.prev=l.first.prev,j.next=l.last.next,delete j.selection),j.insertCmd(b.slice(1),l)):j.insertCh(b),j.hide().parent.blur())})}default:return a=f==="textbox",c=a||f==="editable",g=a?a9:a4,this.each(function(){ah(aa(this),g(),a,c)})}},aa(function(){aa(".mathquill-editable:not(.mathquill-rendered-math)").mathquill("editable"),aa(".mathquill-textbox:not(.mathquill-rendered-math)").mathquill("textbox"),aa(".mathquill-embedded-latex").mathquill()})})();